{"remainingRequest":"/Users/shanebeal/Desktop/bodewiki/node_modules/babel-loader/lib/index.js??ref--0-1!/Users/shanebeal/Desktop/bodewiki/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/shanebeal/Desktop/bodewiki/client/components/editor/editor-markdown.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/shanebeal/Desktop/bodewiki/client/components/editor/editor-markdown.vue","mtime":1742769082000},{"path":"/Users/shanebeal/Desktop/bodewiki/.babelrc","mtime":1742797763162},{"path":"/Users/shanebeal/Desktop/bodewiki/node_modules/cache-loader/dist/cjs.js","mtime":1742846258556},{"path":"/Users/shanebeal/Desktop/bodewiki/node_modules/babel-loader/lib/index.js","mtime":1742846259254},{"path":"/Users/shanebeal/Desktop/bodewiki/node_modules/vue-loader/lib/index.js","mtime":1742846259543}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9zZXQgZnJvbSAibG9kYXNoL3NldCI7CmltcG9ydCBfZmluZExhc3QgZnJvbSAibG9kYXNoL2ZpbmRMYXN0IjsKaW1wb3J0IF9sYXN0IGZyb20gImxvZGFzaC9sYXN0IjsKaW1wb3J0IF9mbGF0dGVuIGZyb20gImxvZGFzaC9mbGF0dGVuIjsKaW1wb3J0IF9nZXQgZnJvbSAibG9kYXNoL2dldCI7CmltcG9ydCBfdGltZXMgZnJvbSAibG9kYXNoL3RpbWVzIjsKaW1wb3J0IF9zdGFydHNXaXRoIGZyb20gImxvZGFzaC9zdGFydHNXaXRoIjsKaW1wb3J0IF9kZWJvdW5jZSBmcm9tICJsb2Rhc2gvZGVib3VuY2UiOwppbXBvcnQgX2VzY2FwZSBmcm9tICJsb2Rhc2gvZXNjYXBlIjsgLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KZnVuY3Rpb24gX3JlZ2VuZXJhdG9yUnVudGltZSgpIHsgInVzZSBzdHJpY3QiOyAvKiEgcmVnZW5lcmF0b3ItcnVudGltZSAtLSBDb3B5cmlnaHQgKGMpIDIwMTQtcHJlc2VudCwgRmFjZWJvb2ssIEluYy4gLS0gbGljZW5zZSAoTUlUKTogaHR0cHM6Ly9naXRodWIuY29tL2ZhY2Vib29rL3JlZ2VuZXJhdG9yL2Jsb2IvbWFpbi9MSUNFTlNFICovIF9yZWdlbmVyYXRvclJ1bnRpbWUgPSBmdW5jdGlvbiBfcmVnZW5lcmF0b3JSdW50aW1lKCkgeyByZXR1cm4gZTsgfTsgdmFyIHQsIGUgPSB7fSwgciA9IE9iamVjdC5wcm90b3R5cGUsIG4gPSByLmhhc093blByb3BlcnR5LCBvID0gT2JqZWN0LmRlZmluZVByb3BlcnR5IHx8IGZ1bmN0aW9uICh0LCBlLCByKSB7IHRbZV0gPSByLnZhbHVlOyB9LCBpID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sID8gU3ltYm9sIDoge30sIGEgPSBpLml0ZXJhdG9yIHx8ICJAQGl0ZXJhdG9yIiwgYyA9IGkuYXN5bmNJdGVyYXRvciB8fCAiQEBhc3luY0l0ZXJhdG9yIiwgdSA9IGkudG9TdHJpbmdUYWcgfHwgIkBAdG9TdHJpbmdUYWciOyBmdW5jdGlvbiBkZWZpbmUodCwgZSwgcikgeyByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsIGUsIHsgdmFsdWU6IHIsIGVudW1lcmFibGU6ICEwLCBjb25maWd1cmFibGU6ICEwLCB3cml0YWJsZTogITAgfSksIHRbZV07IH0gdHJ5IHsgZGVmaW5lKHt9LCAiIik7IH0gY2F0Y2ggKHQpIHsgZGVmaW5lID0gZnVuY3Rpb24gZGVmaW5lKHQsIGUsIHIpIHsgcmV0dXJuIHRbZV0gPSByOyB9OyB9IGZ1bmN0aW9uIHdyYXAodCwgZSwgciwgbikgeyB2YXIgaSA9IGUgJiYgZS5wcm90b3R5cGUgaW5zdGFuY2VvZiBHZW5lcmF0b3IgPyBlIDogR2VuZXJhdG9yLCBhID0gT2JqZWN0LmNyZWF0ZShpLnByb3RvdHlwZSksIGMgPSBuZXcgQ29udGV4dChuIHx8IFtdKTsgcmV0dXJuIG8oYSwgIl9pbnZva2UiLCB7IHZhbHVlOiBtYWtlSW52b2tlTWV0aG9kKHQsIHIsIGMpIH0pLCBhOyB9IGZ1bmN0aW9uIHRyeUNhdGNoKHQsIGUsIHIpIHsgdHJ5IHsgcmV0dXJuIHsgdHlwZTogIm5vcm1hbCIsIGFyZzogdC5jYWxsKGUsIHIpIH07IH0gY2F0Y2ggKHQpIHsgcmV0dXJuIHsgdHlwZTogInRocm93IiwgYXJnOiB0IH07IH0gfSBlLndyYXAgPSB3cmFwOyB2YXIgaCA9ICJzdXNwZW5kZWRTdGFydCIsIGwgPSAic3VzcGVuZGVkWWllbGQiLCBmID0gImV4ZWN1dGluZyIsIHMgPSAiY29tcGxldGVkIiwgeSA9IHt9OyBmdW5jdGlvbiBHZW5lcmF0b3IoKSB7fSBmdW5jdGlvbiBHZW5lcmF0b3JGdW5jdGlvbigpIHt9IGZ1bmN0aW9uIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlKCkge30gdmFyIHAgPSB7fTsgZGVmaW5lKHAsIGEsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0pOyB2YXIgZCA9IE9iamVjdC5nZXRQcm90b3R5cGVPZiwgdiA9IGQgJiYgZChkKHZhbHVlcyhbXSkpKTsgdiAmJiB2ICE9PSByICYmIG4uY2FsbCh2LCBhKSAmJiAocCA9IHYpOyB2YXIgZyA9IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLnByb3RvdHlwZSA9IEdlbmVyYXRvci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHApOyBmdW5jdGlvbiBkZWZpbmVJdGVyYXRvck1ldGhvZHModCkgeyBbIm5leHQiLCAidGhyb3ciLCAicmV0dXJuIl0uZm9yRWFjaChmdW5jdGlvbiAoZSkgeyBkZWZpbmUodCwgZSwgZnVuY3Rpb24gKHQpIHsgcmV0dXJuIHRoaXMuX2ludm9rZShlLCB0KTsgfSk7IH0pOyB9IGZ1bmN0aW9uIEFzeW5jSXRlcmF0b3IodCwgZSkgeyBmdW5jdGlvbiBpbnZva2UociwgbywgaSwgYSkgeyB2YXIgYyA9IHRyeUNhdGNoKHRbcl0sIHQsIG8pOyBpZiAoInRocm93IiAhPT0gYy50eXBlKSB7IHZhciB1ID0gYy5hcmcsIGggPSB1LnZhbHVlOyByZXR1cm4gaCAmJiAib2JqZWN0IiA9PSB0eXBlb2YgaCAmJiBuLmNhbGwoaCwgIl9fYXdhaXQiKSA/IGUucmVzb2x2ZShoLl9fYXdhaXQpLnRoZW4oZnVuY3Rpb24gKHQpIHsgaW52b2tlKCJuZXh0IiwgdCwgaSwgYSk7IH0sIGZ1bmN0aW9uICh0KSB7IGludm9rZSgidGhyb3ciLCB0LCBpLCBhKTsgfSkgOiBlLnJlc29sdmUoaCkudGhlbihmdW5jdGlvbiAodCkgeyB1LnZhbHVlID0gdCwgaSh1KTsgfSwgZnVuY3Rpb24gKHQpIHsgcmV0dXJuIGludm9rZSgidGhyb3ciLCB0LCBpLCBhKTsgfSk7IH0gYShjLmFyZyk7IH0gdmFyIHI7IG8odGhpcywgIl9pbnZva2UiLCB7IHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSh0LCBuKSB7IGZ1bmN0aW9uIGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnKCkgeyByZXR1cm4gbmV3IGUoZnVuY3Rpb24gKGUsIHIpIHsgaW52b2tlKHQsIG4sIGUsIHIpOyB9KTsgfSByZXR1cm4gciA9IHIgPyByLnRoZW4oY2FsbEludm9rZVdpdGhNZXRob2RBbmRBcmcsIGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnKSA6IGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnKCk7IH0gfSk7IH0gZnVuY3Rpb24gbWFrZUludm9rZU1ldGhvZChlLCByLCBuKSB7IHZhciBvID0gaDsgcmV0dXJuIGZ1bmN0aW9uIChpLCBhKSB7IGlmIChvID09PSBmKSB0aHJvdyBFcnJvcigiR2VuZXJhdG9yIGlzIGFscmVhZHkgcnVubmluZyIpOyBpZiAobyA9PT0gcykgeyBpZiAoInRocm93IiA9PT0gaSkgdGhyb3cgYTsgcmV0dXJuIHsgdmFsdWU6IHQsIGRvbmU6ICEwIH07IH0gZm9yIChuLm1ldGhvZCA9IGksIG4uYXJnID0gYTs7KSB7IHZhciBjID0gbi5kZWxlZ2F0ZTsgaWYgKGMpIHsgdmFyIHUgPSBtYXliZUludm9rZURlbGVnYXRlKGMsIG4pOyBpZiAodSkgeyBpZiAodSA9PT0geSkgY29udGludWU7IHJldHVybiB1OyB9IH0gaWYgKCJuZXh0IiA9PT0gbi5tZXRob2QpIG4uc2VudCA9IG4uX3NlbnQgPSBuLmFyZztlbHNlIGlmICgidGhyb3ciID09PSBuLm1ldGhvZCkgeyBpZiAobyA9PT0gaCkgdGhyb3cgbyA9IHMsIG4uYXJnOyBuLmRpc3BhdGNoRXhjZXB0aW9uKG4uYXJnKTsgfSBlbHNlICJyZXR1cm4iID09PSBuLm1ldGhvZCAmJiBuLmFicnVwdCgicmV0dXJuIiwgbi5hcmcpOyBvID0gZjsgdmFyIHAgPSB0cnlDYXRjaChlLCByLCBuKTsgaWYgKCJub3JtYWwiID09PSBwLnR5cGUpIHsgaWYgKG8gPSBuLmRvbmUgPyBzIDogbCwgcC5hcmcgPT09IHkpIGNvbnRpbnVlOyByZXR1cm4geyB2YWx1ZTogcC5hcmcsIGRvbmU6IG4uZG9uZSB9OyB9ICJ0aHJvdyIgPT09IHAudHlwZSAmJiAobyA9IHMsIG4ubWV0aG9kID0gInRocm93Iiwgbi5hcmcgPSBwLmFyZyk7IH0gfTsgfSBmdW5jdGlvbiBtYXliZUludm9rZURlbGVnYXRlKGUsIHIpIHsgdmFyIG4gPSByLm1ldGhvZCwgbyA9IGUuaXRlcmF0b3Jbbl07IGlmIChvID09PSB0KSByZXR1cm4gci5kZWxlZ2F0ZSA9IG51bGwsICJ0aHJvdyIgPT09IG4gJiYgZS5pdGVyYXRvci5yZXR1cm4gJiYgKHIubWV0aG9kID0gInJldHVybiIsIHIuYXJnID0gdCwgbWF5YmVJbnZva2VEZWxlZ2F0ZShlLCByKSwgInRocm93IiA9PT0gci5tZXRob2QpIHx8ICJyZXR1cm4iICE9PSBuICYmIChyLm1ldGhvZCA9ICJ0aHJvdyIsIHIuYXJnID0gbmV3IFR5cGVFcnJvcigiVGhlIGl0ZXJhdG9yIGRvZXMgbm90IHByb3ZpZGUgYSAnIiArIG4gKyAiJyBtZXRob2QiKSksIHk7IHZhciBpID0gdHJ5Q2F0Y2gobywgZS5pdGVyYXRvciwgci5hcmcpOyBpZiAoInRocm93IiA9PT0gaS50eXBlKSByZXR1cm4gci5tZXRob2QgPSAidGhyb3ciLCByLmFyZyA9IGkuYXJnLCByLmRlbGVnYXRlID0gbnVsbCwgeTsgdmFyIGEgPSBpLmFyZzsgcmV0dXJuIGEgPyBhLmRvbmUgPyAocltlLnJlc3VsdE5hbWVdID0gYS52YWx1ZSwgci5uZXh0ID0gZS5uZXh0TG9jLCAicmV0dXJuIiAhPT0gci5tZXRob2QgJiYgKHIubWV0aG9kID0gIm5leHQiLCByLmFyZyA9IHQpLCByLmRlbGVnYXRlID0gbnVsbCwgeSkgOiBhIDogKHIubWV0aG9kID0gInRocm93Iiwgci5hcmcgPSBuZXcgVHlwZUVycm9yKCJpdGVyYXRvciByZXN1bHQgaXMgbm90IGFuIG9iamVjdCIpLCByLmRlbGVnYXRlID0gbnVsbCwgeSk7IH0gZnVuY3Rpb24gcHVzaFRyeUVudHJ5KHQpIHsgdmFyIGUgPSB7IHRyeUxvYzogdFswXSB9OyAxIGluIHQgJiYgKGUuY2F0Y2hMb2MgPSB0WzFdKSwgMiBpbiB0ICYmIChlLmZpbmFsbHlMb2MgPSB0WzJdLCBlLmFmdGVyTG9jID0gdFszXSksIHRoaXMudHJ5RW50cmllcy5wdXNoKGUpOyB9IGZ1bmN0aW9uIHJlc2V0VHJ5RW50cnkodCkgeyB2YXIgZSA9IHQuY29tcGxldGlvbiB8fCB7fTsgZS50eXBlID0gIm5vcm1hbCIsIGRlbGV0ZSBlLmFyZywgdC5jb21wbGV0aW9uID0gZTsgfSBmdW5jdGlvbiBDb250ZXh0KHQpIHsgdGhpcy50cnlFbnRyaWVzID0gW3sgdHJ5TG9jOiAicm9vdCIgfV0sIHQuZm9yRWFjaChwdXNoVHJ5RW50cnksIHRoaXMpLCB0aGlzLnJlc2V0KCEwKTsgfSBmdW5jdGlvbiB2YWx1ZXMoZSkgeyBpZiAoZSB8fCAiIiA9PT0gZSkgeyB2YXIgciA9IGVbYV07IGlmIChyKSByZXR1cm4gci5jYWxsKGUpOyBpZiAoImZ1bmN0aW9uIiA9PSB0eXBlb2YgZS5uZXh0KSByZXR1cm4gZTsgaWYgKCFpc05hTihlLmxlbmd0aCkpIHsgdmFyIG8gPSAtMSwgaSA9IGZ1bmN0aW9uIG5leHQoKSB7IGZvciAoOyArK28gPCBlLmxlbmd0aDspIGlmIChuLmNhbGwoZSwgbykpIHJldHVybiBuZXh0LnZhbHVlID0gZVtvXSwgbmV4dC5kb25lID0gITEsIG5leHQ7IHJldHVybiBuZXh0LnZhbHVlID0gdCwgbmV4dC5kb25lID0gITAsIG5leHQ7IH07IHJldHVybiBpLm5leHQgPSBpOyB9IH0gdGhyb3cgbmV3IFR5cGVFcnJvcih0eXBlb2YgZSArICIgaXMgbm90IGl0ZXJhYmxlIik7IH0gcmV0dXJuIEdlbmVyYXRvckZ1bmN0aW9uLnByb3RvdHlwZSA9IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLCBvKGcsICJjb25zdHJ1Y3RvciIsIHsgdmFsdWU6IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLCBjb25maWd1cmFibGU6ICEwIH0pLCBvKEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLCAiY29uc3RydWN0b3IiLCB7IHZhbHVlOiBHZW5lcmF0b3JGdW5jdGlvbiwgY29uZmlndXJhYmxlOiAhMCB9KSwgR2VuZXJhdG9yRnVuY3Rpb24uZGlzcGxheU5hbWUgPSBkZWZpbmUoR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsIHUsICJHZW5lcmF0b3JGdW5jdGlvbiIpLCBlLmlzR2VuZXJhdG9yRnVuY3Rpb24gPSBmdW5jdGlvbiAodCkgeyB2YXIgZSA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQgJiYgdC5jb25zdHJ1Y3RvcjsgcmV0dXJuICEhZSAmJiAoZSA9PT0gR2VuZXJhdG9yRnVuY3Rpb24gfHwgIkdlbmVyYXRvckZ1bmN0aW9uIiA9PT0gKGUuZGlzcGxheU5hbWUgfHwgZS5uYW1lKSk7IH0sIGUubWFyayA9IGZ1bmN0aW9uICh0KSB7IHJldHVybiBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2YodCwgR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUpIDogKHQuX19wcm90b19fID0gR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsIGRlZmluZSh0LCB1LCAiR2VuZXJhdG9yRnVuY3Rpb24iKSksIHQucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShnKSwgdDsgfSwgZS5hd3JhcCA9IGZ1bmN0aW9uICh0KSB7IHJldHVybiB7IF9fYXdhaXQ6IHQgfTsgfSwgZGVmaW5lSXRlcmF0b3JNZXRob2RzKEFzeW5jSXRlcmF0b3IucHJvdG90eXBlKSwgZGVmaW5lKEFzeW5jSXRlcmF0b3IucHJvdG90eXBlLCBjLCBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzOyB9KSwgZS5Bc3luY0l0ZXJhdG9yID0gQXN5bmNJdGVyYXRvciwgZS5hc3luYyA9IGZ1bmN0aW9uICh0LCByLCBuLCBvLCBpKSB7IHZvaWQgMCA9PT0gaSAmJiAoaSA9IFByb21pc2UpOyB2YXIgYSA9IG5ldyBBc3luY0l0ZXJhdG9yKHdyYXAodCwgciwgbiwgbyksIGkpOyByZXR1cm4gZS5pc0dlbmVyYXRvckZ1bmN0aW9uKHIpID8gYSA6IGEubmV4dCgpLnRoZW4oZnVuY3Rpb24gKHQpIHsgcmV0dXJuIHQuZG9uZSA/IHQudmFsdWUgOiBhLm5leHQoKTsgfSk7IH0sIGRlZmluZUl0ZXJhdG9yTWV0aG9kcyhnKSwgZGVmaW5lKGcsIHUsICJHZW5lcmF0b3IiKSwgZGVmaW5lKGcsIGEsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0pLCBkZWZpbmUoZywgInRvU3RyaW5nIiwgZnVuY3Rpb24gKCkgeyByZXR1cm4gIltvYmplY3QgR2VuZXJhdG9yXSI7IH0pLCBlLmtleXMgPSBmdW5jdGlvbiAodCkgeyB2YXIgZSA9IE9iamVjdCh0KSwgciA9IFtdOyBmb3IgKHZhciBuIGluIGUpIHIucHVzaChuKTsgcmV0dXJuIHIucmV2ZXJzZSgpLCBmdW5jdGlvbiBuZXh0KCkgeyBmb3IgKDsgci5sZW5ndGg7KSB7IHZhciB0ID0gci5wb3AoKTsgaWYgKHQgaW4gZSkgcmV0dXJuIG5leHQudmFsdWUgPSB0LCBuZXh0LmRvbmUgPSAhMSwgbmV4dDsgfSByZXR1cm4gbmV4dC5kb25lID0gITAsIG5leHQ7IH07IH0sIGUudmFsdWVzID0gdmFsdWVzLCBDb250ZXh0LnByb3RvdHlwZSA9IHsgY29uc3RydWN0b3I6IENvbnRleHQsIHJlc2V0OiBmdW5jdGlvbiByZXNldChlKSB7IGlmICh0aGlzLnByZXYgPSAwLCB0aGlzLm5leHQgPSAwLCB0aGlzLnNlbnQgPSB0aGlzLl9zZW50ID0gdCwgdGhpcy5kb25lID0gITEsIHRoaXMuZGVsZWdhdGUgPSBudWxsLCB0aGlzLm1ldGhvZCA9ICJuZXh0IiwgdGhpcy5hcmcgPSB0LCB0aGlzLnRyeUVudHJpZXMuZm9yRWFjaChyZXNldFRyeUVudHJ5KSwgIWUpIGZvciAodmFyIHIgaW4gdGhpcykgInQiID09PSByLmNoYXJBdCgwKSAmJiBuLmNhbGwodGhpcywgcikgJiYgIWlzTmFOKCtyLnNsaWNlKDEpKSAmJiAodGhpc1tyXSA9IHQpOyB9LCBzdG9wOiBmdW5jdGlvbiBzdG9wKCkgeyB0aGlzLmRvbmUgPSAhMDsgdmFyIHQgPSB0aGlzLnRyeUVudHJpZXNbMF0uY29tcGxldGlvbjsgaWYgKCJ0aHJvdyIgPT09IHQudHlwZSkgdGhyb3cgdC5hcmc7IHJldHVybiB0aGlzLnJ2YWw7IH0sIGRpc3BhdGNoRXhjZXB0aW9uOiBmdW5jdGlvbiBkaXNwYXRjaEV4Y2VwdGlvbihlKSB7IGlmICh0aGlzLmRvbmUpIHRocm93IGU7IHZhciByID0gdGhpczsgZnVuY3Rpb24gaGFuZGxlKG4sIG8pIHsgcmV0dXJuIGEudHlwZSA9ICJ0aHJvdyIsIGEuYXJnID0gZSwgci5uZXh0ID0gbiwgbyAmJiAoci5tZXRob2QgPSAibmV4dCIsIHIuYXJnID0gdCksICEhbzsgfSBmb3IgKHZhciBvID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IG8gPj0gMDsgLS1vKSB7IHZhciBpID0gdGhpcy50cnlFbnRyaWVzW29dLCBhID0gaS5jb21wbGV0aW9uOyBpZiAoInJvb3QiID09PSBpLnRyeUxvYykgcmV0dXJuIGhhbmRsZSgiZW5kIik7IGlmIChpLnRyeUxvYyA8PSB0aGlzLnByZXYpIHsgdmFyIGMgPSBuLmNhbGwoaSwgImNhdGNoTG9jIiksIHUgPSBuLmNhbGwoaSwgImZpbmFsbHlMb2MiKTsgaWYgKGMgJiYgdSkgeyBpZiAodGhpcy5wcmV2IDwgaS5jYXRjaExvYykgcmV0dXJuIGhhbmRsZShpLmNhdGNoTG9jLCAhMCk7IGlmICh0aGlzLnByZXYgPCBpLmZpbmFsbHlMb2MpIHJldHVybiBoYW5kbGUoaS5maW5hbGx5TG9jKTsgfSBlbHNlIGlmIChjKSB7IGlmICh0aGlzLnByZXYgPCBpLmNhdGNoTG9jKSByZXR1cm4gaGFuZGxlKGkuY2F0Y2hMb2MsICEwKTsgfSBlbHNlIHsgaWYgKCF1KSB0aHJvdyBFcnJvcigidHJ5IHN0YXRlbWVudCB3aXRob3V0IGNhdGNoIG9yIGZpbmFsbHkiKTsgaWYgKHRoaXMucHJldiA8IGkuZmluYWxseUxvYykgcmV0dXJuIGhhbmRsZShpLmZpbmFsbHlMb2MpOyB9IH0gfSB9LCBhYnJ1cHQ6IGZ1bmN0aW9uIGFicnVwdCh0LCBlKSB7IGZvciAodmFyIHIgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgciA+PSAwOyAtLXIpIHsgdmFyIG8gPSB0aGlzLnRyeUVudHJpZXNbcl07IGlmIChvLnRyeUxvYyA8PSB0aGlzLnByZXYgJiYgbi5jYWxsKG8sICJmaW5hbGx5TG9jIikgJiYgdGhpcy5wcmV2IDwgby5maW5hbGx5TG9jKSB7IHZhciBpID0gbzsgYnJlYWs7IH0gfSBpICYmICgiYnJlYWsiID09PSB0IHx8ICJjb250aW51ZSIgPT09IHQpICYmIGkudHJ5TG9jIDw9IGUgJiYgZSA8PSBpLmZpbmFsbHlMb2MgJiYgKGkgPSBudWxsKTsgdmFyIGEgPSBpID8gaS5jb21wbGV0aW9uIDoge307IHJldHVybiBhLnR5cGUgPSB0LCBhLmFyZyA9IGUsIGkgPyAodGhpcy5tZXRob2QgPSAibmV4dCIsIHRoaXMubmV4dCA9IGkuZmluYWxseUxvYywgeSkgOiB0aGlzLmNvbXBsZXRlKGEpOyB9LCBjb21wbGV0ZTogZnVuY3Rpb24gY29tcGxldGUodCwgZSkgeyBpZiAoInRocm93IiA9PT0gdC50eXBlKSB0aHJvdyB0LmFyZzsgcmV0dXJuICJicmVhayIgPT09IHQudHlwZSB8fCAiY29udGludWUiID09PSB0LnR5cGUgPyB0aGlzLm5leHQgPSB0LmFyZyA6ICJyZXR1cm4iID09PSB0LnR5cGUgPyAodGhpcy5ydmFsID0gdGhpcy5hcmcgPSB0LmFyZywgdGhpcy5tZXRob2QgPSAicmV0dXJuIiwgdGhpcy5uZXh0ID0gImVuZCIpIDogIm5vcm1hbCIgPT09IHQudHlwZSAmJiBlICYmICh0aGlzLm5leHQgPSBlKSwgeTsgfSwgZmluaXNoOiBmdW5jdGlvbiBmaW5pc2godCkgeyBmb3IgKHZhciBlID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGUgPj0gMDsgLS1lKSB7IHZhciByID0gdGhpcy50cnlFbnRyaWVzW2VdOyBpZiAoci5maW5hbGx5TG9jID09PSB0KSByZXR1cm4gdGhpcy5jb21wbGV0ZShyLmNvbXBsZXRpb24sIHIuYWZ0ZXJMb2MpLCByZXNldFRyeUVudHJ5KHIpLCB5OyB9IH0sIGNhdGNoOiBmdW5jdGlvbiBfY2F0Y2godCkgeyBmb3IgKHZhciBlID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGUgPj0gMDsgLS1lKSB7IHZhciByID0gdGhpcy50cnlFbnRyaWVzW2VdOyBpZiAoci50cnlMb2MgPT09IHQpIHsgdmFyIG4gPSByLmNvbXBsZXRpb247IGlmICgidGhyb3ciID09PSBuLnR5cGUpIHsgdmFyIG8gPSBuLmFyZzsgcmVzZXRUcnlFbnRyeShyKTsgfSByZXR1cm4gbzsgfSB9IHRocm93IEVycm9yKCJpbGxlZ2FsIGNhdGNoIGF0dGVtcHQiKTsgfSwgZGVsZWdhdGVZaWVsZDogZnVuY3Rpb24gZGVsZWdhdGVZaWVsZChlLCByLCBuKSB7IHJldHVybiB0aGlzLmRlbGVnYXRlID0geyBpdGVyYXRvcjogdmFsdWVzKGUpLCByZXN1bHROYW1lOiByLCBuZXh0TG9jOiBuIH0sICJuZXh0IiA9PT0gdGhpcy5tZXRob2QgJiYgKHRoaXMuYXJnID0gdCksIHk7IH0gfSwgZTsgfQpmdW5jdGlvbiBhc3luY0dlbmVyYXRvclN0ZXAobiwgdCwgZSwgciwgbywgYSwgYykgeyB0cnkgeyB2YXIgaSA9IG5bYV0oYyksIHUgPSBpLnZhbHVlOyB9IGNhdGNoIChuKSB7IHJldHVybiB2b2lkIGUobik7IH0gaS5kb25lID8gdCh1KSA6IFByb21pc2UucmVzb2x2ZSh1KS50aGVuKHIsIG8pOyB9CmZ1bmN0aW9uIF9hc3luY1RvR2VuZXJhdG9yKG4pIHsgcmV0dXJuIGZ1bmN0aW9uICgpIHsgdmFyIHQgPSB0aGlzLCBlID0gYXJndW1lbnRzOyByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHIsIG8pIHsgdmFyIGEgPSBuLmFwcGx5KHQsIGUpOyBmdW5jdGlvbiBfbmV4dChuKSB7IGFzeW5jR2VuZXJhdG9yU3RlcChhLCByLCBvLCBfbmV4dCwgX3Rocm93LCAibmV4dCIsIG4pOyB9IGZ1bmN0aW9uIF90aHJvdyhuKSB7IGFzeW5jR2VuZXJhdG9yU3RlcChhLCByLCBvLCBfbmV4dCwgX3Rocm93LCAidGhyb3ciLCBuKTsgfSBfbmV4dCh2b2lkIDApOyB9KTsgfTsgfQppbXBvcnQgeyBnZXQsIHN5bmMgfSBmcm9tICd2dWV4LXBhdGhpZnknOwppbXBvcnQgbWFya2Rvd25IZWxwIGZyb20gJy4vbWFya2Rvd24vaGVscC52dWUnOwppbXBvcnQgRE9NUHVyaWZ5IGZyb20gJ2RvbXB1cmlmeSc7CgovKiBnbG9iYWwgc2l0ZUNvbmZpZywgc2l0ZUxhbmdzICovCgovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIElNUE9SVFMKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKLy8gQ29kZSBNaXJyb3IKaW1wb3J0IENvZGVNaXJyb3IgZnJvbSAnY29kZW1pcnJvcic7CmltcG9ydCAnY29kZW1pcnJvci9saWIvY29kZW1pcnJvci5jc3MnOwoKLy8gTGFuZ3VhZ2UKaW1wb3J0ICdjb2RlbWlycm9yL21vZGUvbWFya2Rvd24vbWFya2Rvd24uanMnOwoKLy8gQWRkb25zCmltcG9ydCAnY29kZW1pcnJvci9hZGRvbi9zZWxlY3Rpb24vYWN0aXZlLWxpbmUuanMnOwppbXBvcnQgJ2NvZGVtaXJyb3IvYWRkb24vZGlzcGxheS9mdWxsc2NyZWVuLmpzJzsKaW1wb3J0ICdjb2RlbWlycm9yL2FkZG9uL2Rpc3BsYXkvZnVsbHNjcmVlbi5jc3MnOwppbXBvcnQgJ2NvZGVtaXJyb3IvYWRkb24vc2VsZWN0aW9uL21hcmstc2VsZWN0aW9uLmpzJzsKaW1wb3J0ICdjb2RlbWlycm9yL2FkZG9uL3NlYXJjaC9zZWFyY2hjdXJzb3IuanMnOwppbXBvcnQgJ2NvZGVtaXJyb3IvYWRkb24vaGludC9zaG93LWhpbnQuanMnOwppbXBvcnQgJ2NvZGVtaXJyb3IvYWRkb24vZm9sZC9mb2xkY29kZS5qcyc7CmltcG9ydCAnY29kZW1pcnJvci9hZGRvbi9mb2xkL2ZvbGRndXR0ZXIuanMnOwppbXBvcnQgJ2NvZGVtaXJyb3IvYWRkb24vZm9sZC9mb2xkZ3V0dGVyLmNzcyc7CgovLyBNYXJrZG93bi1pdAppbXBvcnQgTWFya2Rvd25JdCBmcm9tICdtYXJrZG93bi1pdCc7CmltcG9ydCBtZEF0dHJzIGZyb20gJ21hcmtkb3duLWl0LWF0dHJzJzsKaW1wb3J0IG1kRGVjb3JhdGUgZnJvbSAnbWFya2Rvd24taXQtZGVjb3JhdGUnOwppbXBvcnQgeyBmdWxsIGFzIG1kRW1vamkgfSBmcm9tICdtYXJrZG93bi1pdC1lbW9qaSc7CmltcG9ydCBtZFRhc2tMaXN0cyBmcm9tICdtYXJrZG93bi1pdC10YXNrLWxpc3RzJzsKaW1wb3J0IG1kRXhwYW5kVGFicyBmcm9tICdtYXJrZG93bi1pdC1leHBhbmQtdGFicyc7CmltcG9ydCBtZEFiYnIgZnJvbSAnbWFya2Rvd24taXQtYWJicic7CmltcG9ydCBtZFN1cCBmcm9tICdtYXJrZG93bi1pdC1zdXAnOwppbXBvcnQgbWRTdWIgZnJvbSAnbWFya2Rvd24taXQtc3ViJzsKaW1wb3J0IG1kTWFyayBmcm9tICdtYXJrZG93bi1pdC1tYXJrJzsKaW1wb3J0IG1kTXVsdGlUYWJsZSBmcm9tICdtYXJrZG93bi1pdC1tdWx0aW1kLXRhYmxlJzsKaW1wb3J0IG1kRm9vdG5vdGUgZnJvbSAnbWFya2Rvd24taXQtZm9vdG5vdGUnOwppbXBvcnQgbWRJbXNpemUgZnJvbSAnbWFya2Rvd24taXQtaW1zaXplJzsKaW1wb3J0IGthdGV4IGZyb20gJ2thdGV4JzsKaW1wb3J0IHVuZGVybGluZSBmcm9tICcuLi8uLi9saWJzL21hcmtkb3duLWl0LXVuZGVybGluZSc7CmltcG9ydCAna2F0ZXgvZGlzdC9jb250cmliL21oY2hlbSc7CmltcG9ydCB0d2Vtb2ppIGZyb20gJ3R3ZW1vamknOwppbXBvcnQgcGxhbnR1bWwgZnJvbSAnLi9tYXJrZG93bi9wbGFudHVtbCc7CgovLyBQcmlzbSAoU3ludGF4IEhpZ2hsaWdodGluZykKaW1wb3J0IFByaXNtIGZyb20gJ3ByaXNtanMnOwoKLy8gTWVybWFpZAppbXBvcnQgbWVybWFpZCBmcm9tICdtZXJtYWlkJzsKCi8vIEhlbHBlcnMKaW1wb3J0IGthdGV4SGVscGVyIGZyb20gJy4vY29tbW9uL2thdGV4JzsKaW1wb3J0IHRhYnNldEhlbHBlciBmcm9tICcuL21hcmtkb3duL3RhYnNldCc7CmltcG9ydCBjbUZvbGQgZnJvbSAnLi9jb21tb24vY21Gb2xkJzsKCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gSU5JVAovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgovLyBQbGF0Zm9ybSBkZXRlY3Rpb24KdmFyIEN0cmxLZXkgPSAvTWFjLy50ZXN0KG5hdmlnYXRvci5wbGF0Zm9ybSkgPyAnQ21kJyA6ICdDdHJsJzsKCi8vIFByaXNtIENvbmZpZwpQcmlzbS5wbHVnaW5zLmF1dG9sb2FkZXIubGFuZ3VhZ2VzX3BhdGggPSAnL19hc3NldHMvanMvcHJpc20vJzsKUHJpc20ucGx1Z2lucy5Ob3JtYWxpemVXaGl0ZXNwYWNlLnNldERlZmF1bHRzKHsKICAncmVtb3ZlLXRyYWlsaW5nJzogdHJ1ZSwKICAncmVtb3ZlLWluZGVudCc6IHRydWUsCiAgJ2xlZnQtdHJpbSc6IHRydWUsCiAgJ3JpZ2h0LXRyaW0nOiB0cnVlLAogICdyZW1vdmUtaW5pdGlhbC1saW5lLWZlZWQnOiB0cnVlLAogICd0YWJzLXRvLXNwYWNlcyc6IDIKfSk7CgovLyBNYXJrZG93biBJbnN0YW5jZQp2YXIgbWQgPSBuZXcgTWFya2Rvd25JdCh7CiAgaHRtbDogdHJ1ZSwKICBicmVha3M6IHRydWUsCiAgbGlua2lmeTogdHJ1ZSwKICB0eXBvZ3JhcGh5OiB0cnVlLAogIGhpZ2hsaWdodDogZnVuY3Rpb24gaGlnaGxpZ2h0KHN0ciwgbGFuZykgewogICAgaWYgKGxhbmcgPT09ICdkaWFncmFtJykgewogICAgICByZXR1cm4gIjxwcmUgY2xhc3M9XCJkaWFncmFtXCI+IiArIEJ1ZmZlci5mcm9tKHN0ciwgJ2Jhc2U2NCcpLnRvU3RyaW5nKCkgKyAiPC9wcmU+IjsKICAgIH0gZWxzZSBpZiAoWydtZXJtYWlkJywgJ3BsYW50dW1sJ10uaW5jbHVkZXMobGFuZykpIHsKICAgICAgcmV0dXJuICI8cHJlIGNsYXNzPVwiY29kZWJsb2NrLSIgKyBsYW5nICsgIlwiPjxjb2RlPiIgKyBfZXNjYXBlKHN0cikgKyAiPC9jb2RlPjwvcHJlPiI7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gIjxwcmUgY2xhc3M9XCJsaW5lLW51bWJlcnNcIj48Y29kZSBjbGFzcz1cImxhbmd1YWdlLSIgKyBsYW5nICsgIlwiPiIgKyBfZXNjYXBlKHN0cikgKyAiPC9jb2RlPjwvcHJlPiI7CiAgICB9CiAgfQp9KS51c2UobWRBdHRycywgewogIGFsbG93ZWRBdHRyaWJ1dGVzOiBbJ2lkJywgJ2NsYXNzJywgJ3RhcmdldCddCn0pLnVzZShtZERlY29yYXRlKS51c2UodW5kZXJsaW5lKS51c2UobWRFbW9qaSkudXNlKG1kVGFza0xpc3RzLCB7CiAgbGFiZWw6IGZhbHNlLAogIGxhYmVsQWZ0ZXI6IGZhbHNlCn0pLnVzZShtZEV4cGFuZFRhYnMpLnVzZShtZEFiYnIpLnVzZShtZFN1cCkudXNlKG1kU3ViKS51c2UobWRNdWx0aVRhYmxlLCB7CiAgbXVsdGlsaW5lOiB0cnVlLAogIHJvd3NwYW46IHRydWUsCiAgaGVhZGVybGVzczogdHJ1ZQp9KS51c2UobWRNYXJrKS51c2UobWRGb290bm90ZSkudXNlKG1kSW1zaXplKTsKCi8vIERPTVB1cmlmeSBmaXggZm9yIGRyYXcuaW8KRE9NUHVyaWZ5LmFkZEhvb2soJ3Vwb25TYW5pdGl6ZUVsZW1lbnQnLCBmdW5jdGlvbiAoZWxtKSB7CiAgaWYgKGVsbS5xdWVyeVNlbGVjdG9yQWxsKSB7CiAgICB2YXIgYnJlYWtzID0gZWxtLnF1ZXJ5U2VsZWN0b3JBbGwoJ2ZvcmVpZ25PYmplY3QgYnIsIGZvcmVpZ25PYmplY3QgcCcpOwogICAgaWYgKGJyZWFrcyAmJiBicmVha3MubGVuZ3RoKSB7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYnJlYWtzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgYnJlYWtzW2ldLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpLCBicmVha3NbaV0pOwogICAgICB9CiAgICB9CiAgfQp9KTsKCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gSEVMUEVSIEZVTkNUSU9OUwovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgovLyBJbmplY3QgbGluZSBudW1iZXJzIGZvciBwcmV2aWV3IHNjcm9sbCBzeW5jCnZhciBsaW5lc01hcCA9IFtdOwpmdW5jdGlvbiBpbmplY3RMaW5lTnVtYmVycyh0b2tlbnMsIGlkeCwgb3B0aW9ucywgZW52LCBzbGYpIHsKICB2YXIgbGluZTsKICBpZiAodG9rZW5zW2lkeF0ubWFwICYmIHRva2Vuc1tpZHhdLmxldmVsID09PSAwKSB7CiAgICBsaW5lID0gdG9rZW5zW2lkeF0ubWFwWzBdOwogICAgdG9rZW5zW2lkeF0uYXR0ckpvaW4oJ2NsYXNzJywgJ2xpbmUnKTsKICAgIHRva2Vuc1tpZHhdLmF0dHJTZXQoJ2RhdGEtbGluZScsIFN0cmluZyhsaW5lKSk7CiAgICBsaW5lc01hcC5wdXNoKGxpbmUpOwogIH0KICByZXR1cm4gc2xmLnJlbmRlclRva2VuKHRva2VucywgaWR4LCBvcHRpb25zLCBlbnYsIHNsZik7Cn0KbWQucmVuZGVyZXIucnVsZXMucGFyYWdyYXBoX29wZW4gPSBpbmplY3RMaW5lTnVtYmVyczsKbWQucmVuZGVyZXIucnVsZXMuaGVhZGluZ19vcGVuID0gaW5qZWN0TGluZU51bWJlcnM7Cm1kLnJlbmRlcmVyLnJ1bGVzLmJsb2NrcXVvdGVfb3BlbiA9IGluamVjdExpbmVOdW1iZXJzOwpjbUZvbGQucmVnaXN0ZXIoJ21hcmtkb3duJyk7Ci8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gUExBTlRVTUwKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKLy8gVE9ETzogVXNlIHNhbWUgb3B0aW9ucyBhcyBkZWZpbmVkIGluIGJhY2tlbmQKcGxhbnR1bWwuaW5pdChtZCwge30pOwoKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBLQVRFWAovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Cgp2YXIgbWFjcm9zID0ge307Cm1kLmlubGluZS5ydWxlci5hZnRlcignZXNjYXBlJywgJ2thdGV4X2lubGluZScsIGthdGV4SGVscGVyLmthdGV4SW5saW5lKTsKbWQucmVuZGVyZXIucnVsZXMua2F0ZXhfaW5saW5lID0gZnVuY3Rpb24gKHRva2VucywgaWR4KSB7CiAgdHJ5IHsKICAgIHJldHVybiBrYXRleC5yZW5kZXJUb1N0cmluZyh0b2tlbnNbaWR4XS5jb250ZW50LCB7CiAgICAgIGRpc3BsYXlNb2RlOiBmYWxzZSwKICAgICAgbWFjcm9zOiBtYWNyb3MKICAgIH0pOwogIH0gY2F0Y2ggKGVycikgewogICAgY29uc29sZS53YXJuKGVycik7CiAgICByZXR1cm4gdG9rZW5zW2lkeF0uY29udGVudDsKICB9Cn07Cm1kLmJsb2NrLnJ1bGVyLmFmdGVyKCdibG9ja3F1b3RlJywgJ2thdGV4X2Jsb2NrJywga2F0ZXhIZWxwZXIua2F0ZXhCbG9jaywgewogIGFsdDogWydwYXJhZ3JhcGgnLCAncmVmZXJlbmNlJywgJ2Jsb2NrcXVvdGUnLCAnbGlzdCddCn0pOwptZC5yZW5kZXJlci5ydWxlcy5rYXRleF9ibG9jayA9IGZ1bmN0aW9uICh0b2tlbnMsIGlkeCkgewogIHRyeSB7CiAgICByZXR1cm4gIjxwPiIgKyBrYXRleC5yZW5kZXJUb1N0cmluZyh0b2tlbnNbaWR4XS5jb250ZW50LCB7CiAgICAgIGRpc3BsYXlNb2RlOiB0cnVlLAogICAgICBtYWNyb3M6IG1hY3JvcwogICAgfSkgKyAiPC9wPiI7CiAgfSBjYXRjaCAoZXJyKSB7CiAgICBjb25zb2xlLndhcm4oZXJyKTsKICAgIHJldHVybiB0b2tlbnNbaWR4XS5jb250ZW50OwogIH0KfTsKCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gVFdFTU9KSQovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgptZC5yZW5kZXJlci5ydWxlcy5lbW9qaSA9IGZ1bmN0aW9uICh0b2tlbiwgaWR4KSB7CiAgcmV0dXJuIHR3ZW1vamkucGFyc2UodG9rZW5baWR4XS5jb250ZW50LCB7CiAgICBjYWxsYmFjazogZnVuY3Rpb24gY2FsbGJhY2soaWNvbiwgb3B0cykgewogICAgICByZXR1cm4gIi9fYXNzZXRzL3N2Zy90d2Vtb2ppLyIgKyBpY29uICsgIi5zdmciOwogICAgfQogIH0pOwp9OwoKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBWdWUgQ29tcG9uZW50Ci8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCnZhciBtZXJtYWlkSWQgPSAwOwpleHBvcnQgZGVmYXVsdCB7CiAgY29tcG9uZW50czogewogICAgbWFya2Rvd25IZWxwOiBtYXJrZG93bkhlbHAKICB9LAogIHByb3BzOiB7CiAgICBzYXZlOiB7CiAgICAgIHR5cGU6IEZ1bmN0aW9uLAogICAgICBkZWZhdWx0OiBmdW5jdGlvbiBfZGVmYXVsdCgpIHt9CiAgICB9CiAgfSwKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgZmFiSW5zZXJ0TWVudTogZmFsc2UsCiAgICAgIGNtOiBudWxsLAogICAgICBjdXJzb3JQb3M6IHsKICAgICAgICBjaDogMCwKICAgICAgICBsaW5lOiAxCiAgICAgIH0sCiAgICAgIHByZXZpZXdTaG93bjogdHJ1ZSwKICAgICAgcHJldmlld0hUTUw6ICcnLAogICAgICBoZWxwU2hvd246IGZhbHNlLAogICAgICBzcGVsbE1vZGVBY3RpdmU6IGZhbHNlLAogICAgICBpbnNlcnRMaW5rRGlhbG9nOiBmYWxzZQogICAgfTsKICB9LAogIGNvbXB1dGVkOiB7CiAgICBpc01vYmlsZTogZnVuY3Rpb24gaXNNb2JpbGUoKSB7CiAgICAgIHJldHVybiB0aGlzLiR2dWV0aWZ5LmJyZWFrcG9pbnQuc21BbmREb3duOwogICAgfSwKICAgIGlzTW9kYWxTaG93bjogZnVuY3Rpb24gaXNNb2RhbFNob3duKCkgewogICAgICByZXR1cm4gdGhpcy5oZWxwU2hvd24gfHwgdGhpcy5hY3RpdmVNb2RhbCAhPT0gJyc7CiAgICB9LAogICAgbG9jYWxlOiBnZXQoJ3BhZ2UvbG9jYWxlJyksCiAgICBwYXRoOiBnZXQoJ3BhZ2UvcGF0aCcpLAogICAgbW9kZTogZ2V0KCdlZGl0b3IvbW9kZScpLAogICAgYWN0aXZlTW9kYWw6IHN5bmMoJ2VkaXRvci9hY3RpdmVNb2RhbCcpCiAgfSwKICB3YXRjaDogewogICAgcHJldmlld1Nob3duOiBmdW5jdGlvbiBwcmV2aWV3U2hvd24obmV3VmFsdWUsIG9sZFZhbHVlKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIGlmIChuZXdWYWx1ZSAmJiAhb2xkVmFsdWUpIHsKICAgICAgICB0aGlzLiRuZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfdGhpcy5yZW5kZXJNZXJtYWlkRGlhZ3JhbXMoKTsKICAgICAgICAgIFByaXNtLmhpZ2hsaWdodEFsbFVuZGVyKF90aGlzLiRyZWZzLmVkaXRvclByZXZpZXcpOwogICAgICAgICAgQXJyYXkuZnJvbShfdGhpcy4kcmVmcy5lZGl0b3JQcmV2aWV3LnF1ZXJ5U2VsZWN0b3JBbGwoJ3ByZS5saW5lLW51bWJlcnMnKSkuZm9yRWFjaChmdW5jdGlvbiAocHJlKSB7CiAgICAgICAgICAgIHJldHVybiBwcmUuY2xhc3NMaXN0LmFkZCgncHJpc21qcycpOwogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBzcGVsbE1vZGVBY3RpdmU6IGZ1bmN0aW9uIHNwZWxsTW9kZUFjdGl2ZShuZXdWYWx1ZSwgb2xkVmFsdWUpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CiAgICAgIGlmIChuZXdWYWx1ZSkgewogICAgICAgIHRoaXMuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIF90aGlzMi4kcmVmcy5lZGl0b3JQcmV2aWV3LmZvY3VzKCk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIHRvZ2dsZU1vZGFsOiBmdW5jdGlvbiB0b2dnbGVNb2RhbChrZXkpIHsKICAgICAgdGhpcy5hY3RpdmVNb2RhbCA9IHRoaXMuYWN0aXZlTW9kYWwgPT09IGtleSA/ICcnIDoga2V5OwogICAgICB0aGlzLmhlbHBTaG93biA9IGZhbHNlOwogICAgfSwKICAgIGNsb3NlQWxsTW9kYWw6IGZ1bmN0aW9uIGNsb3NlQWxsTW9kYWwoKSB7CiAgICAgIHRoaXMuYWN0aXZlTW9kYWwgPSAnJzsKICAgICAgdGhpcy5oZWxwU2hvd24gPSBmYWxzZTsKICAgIH0sCiAgICBvbkNtSW5wdXQ6IF9kZWJvdW5jZShmdW5jdGlvbiAobmV3Q29udGVudCkgewogICAgICB0aGlzLnByb2Nlc3NDb250ZW50KG5ld0NvbnRlbnQpOwogICAgfSwgNjAwKSwKICAgIG9uQ21QYXN0ZTogZnVuY3Rpb24gb25DbVBhc3RlKGNtLCBldikgewogICAgICAvLyBjb25zdCBjbGlwSXRlbXMgPSAoZXYuY2xpcGJvYXJkRGF0YSB8fCBldi5vcmlnaW5hbEV2ZW50LmNsaXBib2FyZERhdGEpLml0ZW1zCiAgICAgIC8vIGZvciAobGV0IGNsaXBJdGVtIG9mIGNsaXBJdGVtcykgewogICAgICAvLyAgIGlmIChfLnN0YXJ0c1dpdGgoY2xpcEl0ZW0udHlwZSwgJ2ltYWdlLycpKSB7CiAgICAgIC8vICAgICBjb25zdCBmaWxlID0gY2xpcEl0ZW0uZ2V0QXNGaWxlKCkKICAgICAgLy8gICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCkKICAgICAgLy8gICAgIHJlYWRlci5vbmxvYWQgPSBldnQgPT4gewogICAgICAvLyAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoYGxvYWRpbmdTdGFydGAsICdlZGl0b3ItcGFzdGUtaW1hZ2UnKQogICAgICAvLyAgICAgICB0aGlzLmluc2VydEFmdGVyKHsKICAgICAgLy8gICAgICAgICBjb250ZW50OiBgIVske2ZpbGUubmFtZX1dKCR7ZXZ0LnRhcmdldC5yZXN1bHR9KWAsCiAgICAgIC8vICAgICAgICAgbmV3TGluZTogdHJ1ZQogICAgICAvLyAgICAgICB9KQogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSkKICAgICAgLy8gICB9CiAgICAgIC8vIH0KICAgIH0sCiAgICBwcm9jZXNzQ29udGVudDogZnVuY3Rpb24gcHJvY2Vzc0NvbnRlbnQobmV3Q29udGVudCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKICAgICAgbGluZXNNYXAgPSBbXTsKICAgICAgLy8gdGhpcy4kc3RvcmUuc2V0KCdlZGl0b3IvY29udGVudCcsIG5ld0NvbnRlbnQpCiAgICAgIHRoaXMucHJvY2Vzc01hcmtlcnModGhpcy5jbS5maXJzdExpbmUoKSwgdGhpcy5jbS5sYXN0TGluZSgpKTsKICAgICAgdGhpcy5wcmV2aWV3SFRNTCA9IERPTVB1cmlmeS5zYW5pdGl6ZShtZC5yZW5kZXIobmV3Q29udGVudCksIHsKICAgICAgICBBRERfVEFHUzogWydmb3JlaWduT2JqZWN0J10KICAgICAgfSk7CiAgICAgIHRoaXMuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICB0YWJzZXRIZWxwZXIuZm9ybWF0KCk7CiAgICAgICAgX3RoaXMzLnJlbmRlck1lcm1haWREaWFncmFtcygpOwogICAgICAgIFByaXNtLmhpZ2hsaWdodEFsbFVuZGVyKF90aGlzMy4kcmVmcy5lZGl0b3JQcmV2aWV3KTsKICAgICAgICBBcnJheS5mcm9tKF90aGlzMy4kcmVmcy5lZGl0b3JQcmV2aWV3LnF1ZXJ5U2VsZWN0b3JBbGwoJ3ByZS5saW5lLW51bWJlcnMnKSkuZm9yRWFjaChmdW5jdGlvbiAocHJlKSB7CiAgICAgICAgICByZXR1cm4gcHJlLmNsYXNzTGlzdC5hZGQoJ3ByaXNtanMnKTsKICAgICAgICB9KTsKICAgICAgICBfdGhpczMuc2Nyb2xsU3luYyhfdGhpczMuY20pOwogICAgICB9KTsKICAgIH0sCiAgICAvKioKICAgICAqIFVwZGF0ZSBjdXJzb3Igc3RhdGUKICAgICAqLwogICAgcG9zaXRpb25TeW5jOiBmdW5jdGlvbiBwb3NpdGlvblN5bmMoY20pIHsKICAgICAgdGhpcy5jdXJzb3JQb3MgPSBjbS5nZXRDdXJzb3IoJ2hlYWQnKTsKICAgIH0sCiAgICAvKioKICAgICAqIFdyYXAgc2VsZWN0aW9uIHdpdGggc3RhcnQgLyBlbmQgdGFncwogICAgICovCiAgICB0b2dnbGVNYXJrdXA6IGZ1bmN0aW9uIHRvZ2dsZU1hcmt1cChfcmVmKSB7CiAgICAgIHZhciBzdGFydCA9IF9yZWYuc3RhcnQsCiAgICAgICAgZW5kID0gX3JlZi5lbmQ7CiAgICAgIGlmICghZW5kKSB7CiAgICAgICAgZW5kID0gc3RhcnQ7CiAgICAgIH0KICAgICAgaWYgKCF0aGlzLmNtLmRvYy5zb21ldGhpbmdTZWxlY3RlZCgpKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuJHN0b3JlLmNvbW1pdCgnc2hvd05vdGlmaWNhdGlvbicsIHsKICAgICAgICAgIG1lc3NhZ2U6IHRoaXMuJHQoJ2VkaXRvcjptYXJrdXAubm9TZWxlY3Rpb25FcnJvcicpLAogICAgICAgICAgc3R5bGU6ICd3YXJuaW5nJywKICAgICAgICAgIGljb246ICd3YXJuaW5nJwogICAgICAgIH0pOwogICAgICB9CiAgICAgIHRoaXMuY20uZG9jLnJlcGxhY2VTZWxlY3Rpb25zKHRoaXMuY20uZG9jLmdldFNlbGVjdGlvbnMoKS5tYXAoZnVuY3Rpb24gKHMpIHsKICAgICAgICByZXR1cm4gc3RhcnQgKyBzICsgZW5kOwogICAgICB9KSk7CiAgICB9LAogICAgLyoqCiAgICAgKiBTZXQgY3VycmVudCBsaW5lIGFzIGhlYWRlcgogICAgICovCiAgICBzZXRIZWFkZXJMaW5lOiBmdW5jdGlvbiBzZXRIZWFkZXJMaW5lKGx2bCkgewogICAgICB2YXIgY3VyTGluZSA9IHRoaXMuY20uZG9jLmdldEN1cnNvcignaGVhZCcpLmxpbmU7CiAgICAgIHZhciBsaW5lQ29udGVudCA9IHRoaXMuY20uZG9jLmdldExpbmUoY3VyTGluZSk7CiAgICAgIHZhciBsaW5lTGVuZ3RoID0gbGluZUNvbnRlbnQubGVuZ3RoOwogICAgICBpZiAoX3N0YXJ0c1dpdGgobGluZUNvbnRlbnQsICcjJykpIHsKICAgICAgICBsaW5lQ29udGVudCA9IGxpbmVDb250ZW50LnJlcGxhY2UoL14oIysgKS8sICcnKTsKICAgICAgfQogICAgICBsaW5lQ29udGVudCA9IF90aW1lcyhsdmwsIGZ1bmN0aW9uIChuKSB7CiAgICAgICAgcmV0dXJuICcjJzsKICAgICAgfSkuam9pbignJykgKyAiICIgKyBsaW5lQ29udGVudDsKICAgICAgdGhpcy5jbS5kb2MucmVwbGFjZVJhbmdlKGxpbmVDb250ZW50LCB7CiAgICAgICAgbGluZTogY3VyTGluZSwKICAgICAgICBjaDogMAogICAgICB9LCB7CiAgICAgICAgbGluZTogY3VyTGluZSwKICAgICAgICBjaDogbGluZUxlbmd0aAogICAgICB9KTsKICAgIH0sCiAgICAvKioKICAgICAqIEdldCB0aGUgaGVhZGVyIGxldmVyIG9mIHRoZSBjdXJyZW50IGxpbmUKICAgICAqLwogICAgZ2V0SGVhZGVyTGV2ZWw6IGZ1bmN0aW9uIGdldEhlYWRlckxldmVsKGNtKSB7CiAgICAgIHZhciBjdXJMaW5lID0gdGhpcy5jbS5kb2MuZ2V0Q3Vyc29yKCdoZWFkJykubGluZTsKICAgICAgdmFyIGxpbmVDb250ZW50ID0gdGhpcy5jbS5kb2MuZ2V0TGluZShjdXJMaW5lKTsKICAgICAgdmFyIGx2bCA9IDA7CiAgICAgIHZhciByZXN1bHQgPSBsaW5lQ29udGVudC5tYXRjaCgvXigjKykgLyk7CiAgICAgIGlmIChyZXN1bHQpIHsKICAgICAgICBsdmwgPSBfZ2V0KHJlc3VsdCwgJ1sxXScsICcnKS5sZW5ndGg7CiAgICAgIH0KICAgICAgcmV0dXJuIGx2bDsKICAgIH0sCiAgICAvKioKICAgICAqIEluc2VydCBjb250ZW50IGF0IGN1cnNvcgogICAgICovCiAgICBpbnNlcnRBdEN1cnNvcjogZnVuY3Rpb24gaW5zZXJ0QXRDdXJzb3IoX3JlZjIpIHsKICAgICAgdmFyIGNvbnRlbnQgPSBfcmVmMi5jb250ZW50OwogICAgICB2YXIgY3Vyc29yID0gdGhpcy5jbS5kb2MuZ2V0Q3Vyc29yKCdoZWFkJyk7CiAgICAgIHRoaXMuY20uZG9jLnJlcGxhY2VSYW5nZShjb250ZW50LCBjdXJzb3IpOwogICAgfSwKICAgIC8qKgogICAgICogSW5zZXJ0IGNvbnRlbnQgYWZ0ZXIgY3VycmVudCBsaW5lCiAgICAgKi8KICAgIGluc2VydEFmdGVyOiBmdW5jdGlvbiBpbnNlcnRBZnRlcihfcmVmMykgewogICAgICB2YXIgY29udGVudCA9IF9yZWYzLmNvbnRlbnQsCiAgICAgICAgbmV3TGluZSA9IF9yZWYzLm5ld0xpbmU7CiAgICAgIHZhciBjdXJMaW5lID0gdGhpcy5jbS5kb2MuZ2V0Q3Vyc29yKCd0bycpLmxpbmU7CiAgICAgIHZhciBsaW5lTGVuZ3RoID0gdGhpcy5jbS5kb2MuZ2V0TGluZShjdXJMaW5lKS5sZW5ndGg7CiAgICAgIHRoaXMuY20uZG9jLnJlcGxhY2VSYW5nZShuZXdMaW5lID8gIlxuIiArIGNvbnRlbnQgKyAiXG4iIDogY29udGVudCwgewogICAgICAgIGxpbmU6IGN1ckxpbmUsCiAgICAgICAgY2g6IGxpbmVMZW5ndGggKyAxCiAgICAgIH0pOwogICAgfSwKICAgIC8qKgogICAgICogSW5zZXJ0IGNvbnRlbnQgYmVmb3JlIGN1cnJlbnQgbGluZQogICAgICovCiAgICBpbnNlcnRCZWZvcmVFYWNoTGluZTogZnVuY3Rpb24gaW5zZXJ0QmVmb3JlRWFjaExpbmUoX3JlZjQpIHsKICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CiAgICAgIHZhciBjb250ZW50ID0gX3JlZjQuY29udGVudCwKICAgICAgICBhZnRlciA9IF9yZWY0LmFmdGVyOwogICAgICB2YXIgbGluZXMgPSBbXTsKICAgICAgaWYgKCF0aGlzLmNtLmRvYy5zb21ldGhpbmdTZWxlY3RlZCgpKSB7CiAgICAgICAgbGluZXMucHVzaCh0aGlzLmNtLmRvYy5nZXRDdXJzb3IoJ2hlYWQnKS5saW5lKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBsaW5lcyA9IF9mbGF0dGVuKHRoaXMuY20uZG9jLmxpc3RTZWxlY3Rpb25zKCkubWFwKGZ1bmN0aW9uIChzbCkgewogICAgICAgICAgdmFyIHJhbmdlID0gTWF0aC5hYnMoc2wuYW5jaG9yLmxpbmUgLSBzbC5oZWFkLmxpbmUpICsgMTsKICAgICAgICAgIHZhciBsb3dlc3RMaW5lID0gc2wuYW5jaG9yLmxpbmUgPiBzbC5oZWFkLmxpbmUgPyBzbC5oZWFkLmxpbmUgOiBzbC5hbmNob3IubGluZTsKICAgICAgICAgIHJldHVybiBfdGltZXMocmFuZ2UsIGZ1bmN0aW9uIChsKSB7CiAgICAgICAgICAgIHJldHVybiBsICsgbG93ZXN0TGluZTsKICAgICAgICAgIH0pOwogICAgICAgIH0pKTsKICAgICAgfQogICAgICBsaW5lcy5mb3JFYWNoKGZ1bmN0aW9uIChsbikgewogICAgICAgIHZhciBsaW5lQ29udGVudCA9IF90aGlzNC5jbS5kb2MuZ2V0TGluZShsbik7CiAgICAgICAgdmFyIGxpbmVMZW5ndGggPSBsaW5lQ29udGVudC5sZW5ndGg7CiAgICAgICAgaWYgKF9zdGFydHNXaXRoKGxpbmVDb250ZW50LCBjb250ZW50KSkgewogICAgICAgICAgbGluZUNvbnRlbnQgPSBsaW5lQ29udGVudC5zdWJzdHJpbmcoY29udGVudC5sZW5ndGgpOwogICAgICAgIH0KICAgICAgICBfdGhpczQuY20uZG9jLnJlcGxhY2VSYW5nZShjb250ZW50ICsgbGluZUNvbnRlbnQsIHsKICAgICAgICAgIGxpbmU6IGxuLAogICAgICAgICAgY2g6IDAKICAgICAgICB9LCB7CiAgICAgICAgICBsaW5lOiBsbiwKICAgICAgICAgIGNoOiBsaW5lTGVuZ3RoCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgICBpZiAoYWZ0ZXIpIHsKICAgICAgICB2YXIgbGFzdExpbmUgPSBfbGFzdChsaW5lcyk7CiAgICAgICAgdGhpcy5jbS5kb2MucmVwbGFjZVJhbmdlKCJcbiIgKyBhZnRlciArICJcbiIsIHsKICAgICAgICAgIGxpbmU6IGxhc3RMaW5lLAogICAgICAgICAgY2g6IHRoaXMuY20uZG9jLmdldExpbmUobGFzdExpbmUpLmxlbmd0aCArIDEKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIC8qKgogICAgICogVXBkYXRlIHNjcm9sbCBzeW5jCiAgICAgKi8KICAgIHNjcm9sbFN5bmM6IF9kZWJvdW5jZShmdW5jdGlvbiAoY20pIHsKICAgICAgaWYgKCF0aGlzLnByZXZpZXdTaG93biB8fCBjbS5zb21ldGhpbmdTZWxlY3RlZCgpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHZhciBjdXJyZW50TGluZSA9IGNtLmdldEN1cnNvcigpLmxpbmU7CiAgICAgIGlmIChjdXJyZW50TGluZSA8IDMpIHsKICAgICAgICB0aGlzLlZlbG9jaXR5KHRoaXMuJHJlZnMuZWRpdG9yUHJldmlldywgJ3N0b3AnLCB0cnVlKTsKICAgICAgICB0aGlzLlZlbG9jaXR5KHRoaXMuJHJlZnMuZWRpdG9yUHJldmlldy5maXJzdENoaWxkLCAnc2Nyb2xsJywgewogICAgICAgICAgb2Zmc2V0OiAnLTUwJywKICAgICAgICAgIGR1cmF0aW9uOiAxMDAwLAogICAgICAgICAgY29udGFpbmVyOiB0aGlzLiRyZWZzLmVkaXRvclByZXZpZXdDb250YWluZXIKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgY2xvc2VzdExpbmUgPSBfZmluZExhc3QobGluZXNNYXAsIGZ1bmN0aW9uIChuKSB7CiAgICAgICAgICByZXR1cm4gbiA8PSBjdXJyZW50TGluZTsKICAgICAgICB9KTsKICAgICAgICB2YXIgZGVzdEVsbSA9IHRoaXMuJHJlZnMuZWRpdG9yUHJldmlldy5xdWVyeVNlbGVjdG9yKCJbZGF0YS1saW5lPSciICsgY2xvc2VzdExpbmUgKyAiJ10iKTsKICAgICAgICBpZiAoZGVzdEVsbSkgewogICAgICAgICAgdGhpcy5WZWxvY2l0eSh0aGlzLiRyZWZzLmVkaXRvclByZXZpZXcsICdzdG9wJywgdHJ1ZSk7CiAgICAgICAgICB0aGlzLlZlbG9jaXR5KGRlc3RFbG0sICdzY3JvbGwnLCB7CiAgICAgICAgICAgIG9mZnNldDogJy0xMDAnLAogICAgICAgICAgICBkdXJhdGlvbjogMTAwMCwKICAgICAgICAgICAgY29udGFpbmVyOiB0aGlzLiRyZWZzLmVkaXRvclByZXZpZXdDb250YWluZXIKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfSwgNTAwKSwKICAgIHRvZ2dsZUhlbHA6IGZ1bmN0aW9uIHRvZ2dsZUhlbHAoKSB7CiAgICAgIHRoaXMuaGVscFNob3duID0gIXRoaXMuaGVscFNob3duOwogICAgICB0aGlzLmFjdGl2ZU1vZGFsID0gJyc7CiAgICB9LAogICAgdG9nZ2xlRnVsbHNjcmVlbjogZnVuY3Rpb24gdG9nZ2xlRnVsbHNjcmVlbigpIHsKICAgICAgdGhpcy5jbS5zZXRPcHRpb24oJ2Z1bGxTY3JlZW4nLCB0cnVlKTsKICAgIH0sCiAgICByZWZyZXNoOiBmdW5jdGlvbiByZWZyZXNoKCkgewogICAgICB2YXIgX3RoaXM1ID0gdGhpczsKICAgICAgdGhpcy4kbmV4dFRpY2soZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzNS5jbS5yZWZyZXNoKCk7CiAgICAgIH0pOwogICAgfSwKICAgIHJlbmRlck1lcm1haWREaWFncmFtczogZnVuY3Rpb24gcmVuZGVyTWVybWFpZERpYWdyYW1zKCkgewogICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZWRpdG9yLW1hcmtkb3duLXByZXZpZXcgcHJlLmNvZGVibG9jay1tZXJtYWlkID4gY29kZScpLmZvckVhY2goZnVuY3Rpb24gKGVsbSkgewogICAgICAgIG1lcm1haWRJZCsrOwogICAgICAgIHZhciBtZXJtYWlkRGVmID0gZWxtLmlubmVyVGV4dDsKICAgICAgICB2YXIgbW1FbG0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICBtbUVsbS5pbm5lckhUTUwgPSAiPGRpdiBpZD1cIm1lcm1haWQtaWQtIiArIG1lcm1haWRJZCArICJcIj4iICsgbWVybWFpZC5yZW5kZXIoIm1lcm1haWQtaWQtIiArIG1lcm1haWRJZCwgbWVybWFpZERlZikgKyAiPC9kaXY+IjsKICAgICAgICBlbG0ucGFyZW50RWxlbWVudC5yZXBsYWNlV2l0aChtbUVsbSk7CiAgICAgIH0pOwogICAgfSwKICAgIGF1dG9jb21wbGV0ZTogZnVuY3Rpb24gYXV0b2NvbXBsZXRlKGNtLCBjaGFuZ2UpIHsKICAgICAgdmFyIF90aGlzNiA9IHRoaXM7CiAgICAgIGlmIChjbS5nZXRNb2RlQXQoY20uZ2V0Q3Vyc29yKCkpLm5hbWUgIT09ICdtYXJrZG93bicpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIC8vIExpbmtzCiAgICAgIGlmIChjaGFuZ2UudGV4dFswXSA9PT0gJygnKSB7CiAgICAgICAgdmFyIGN1ckxpbmUgPSBjbS5nZXRMaW5lKGNoYW5nZS5mcm9tLmxpbmUpLnN1YnN0cmluZygwLCBjaGFuZ2UuZnJvbS5jaCk7CiAgICAgICAgaWYgKGN1ckxpbmVbY3VyTGluZS5sZW5ndGggLSAxXSA9PT0gJ10nKSB7CiAgICAgICAgICBjbS5zaG93SGludCh7CiAgICAgICAgICAgIGhpbnQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICB2YXIgX2hpbnQgPSBfYXN5bmNUb0dlbmVyYXRvcigvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZSgpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZShjbSwgb3B0aW9ucykgewogICAgICAgICAgICAgICAgdmFyIGN1ciwgY3VyTGluZSwgcXVlcnlTdHJpbmcsIHRva2VuLCByZXNwUmF3LCByZXNwOwogICAgICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICAgICAgICAgIHdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgY3VyID0gY20uZ2V0Q3Vyc29yKCk7CiAgICAgICAgICAgICAgICAgICAgICBjdXJMaW5lID0gY20uZ2V0TGluZShjdXIubGluZSkuc3Vic3RyaW5nKDAsIGN1ci5jaCk7CiAgICAgICAgICAgICAgICAgICAgICBxdWVyeVN0cmluZyA9IGN1ckxpbmUuc3Vic3RyaW5nKGN1ckxpbmUubGFzdEluZGV4T2YoJ1snKSArIDEsIGN1ckxpbmUubGVuZ3RoIC0gMik7CiAgICAgICAgICAgICAgICAgICAgICB0b2tlbiA9IGNtLmdldFRva2VuQXQoY3VyKTsKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSA0OwogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDc7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXM2LiRhcG9sbG8ucXVlcnkoewogICAgICAgICAgICAgICAgICAgICAgICBxdWVyeTogewogICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIkRvY3VtZW50IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAiZGVmaW5pdGlvbnMiOiBbewogICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiT3BlcmF0aW9uRGVmaW5pdGlvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAib3BlcmF0aW9uIjogInF1ZXJ5IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YXJpYWJsZURlZmluaXRpb25zIjogW3sKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiVmFyaWFibGVEZWZpbml0aW9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhcmlhYmxlIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIlZhcmlhYmxlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIk5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogInF1ZXJ5IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInR5cGUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiTm9uTnVsbFR5cGUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ0eXBlIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiTmFtZWRUeXBlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJuYW1lIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJOYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJkaXJlY3RpdmVzIjogW10KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiVmFyaWFibGVEZWZpbml0aW9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhcmlhYmxlIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIlZhcmlhYmxlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIk5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogImxvY2FsZSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ0eXBlIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIk5hbWVkVHlwZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJOYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZGlyZWN0aXZlcyI6IFtdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJkaXJlY3RpdmVzIjogW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAic2VsZWN0aW9uU2V0IjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJTZWxlY3Rpb25TZXQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAic2VsZWN0aW9ucyI6IFt7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiRmllbGQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJuYW1lIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiTmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAicGFnZXMiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYXJndW1lbnRzIjogW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImRpcmVjdGl2ZXMiOiBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAic2VsZWN0aW9uU2V0IjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiU2VsZWN0aW9uU2V0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzZWxlY3Rpb25zIjogW3sKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiRmllbGQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJOYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAic2VhcmNoIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYXJndW1lbnRzIjogW3sKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJBcmd1bWVudCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJOYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICJxdWVyeSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIlZhcmlhYmxlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJuYW1lIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJOYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogInF1ZXJ5IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIkFyZ3VtZW50IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIk5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogImxvY2FsZSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIlZhcmlhYmxlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJuYW1lIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJOYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogImxvY2FsZSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1dLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZGlyZWN0aXZlcyI6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAic2VsZWN0aW9uU2V0IjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIlNlbGVjdGlvblNldCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInNlbGVjdGlvbnMiOiBbewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiRmllbGQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIk5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAicmVzdWx0cyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYXJndW1lbnRzIjogW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZGlyZWN0aXZlcyI6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInNlbGVjdGlvblNldCI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiU2VsZWN0aW9uU2V0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInNlbGVjdGlvbnMiOiBbewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIkZpZWxkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIk5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogInRpdGxlIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImFyZ3VtZW50cyI6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJkaXJlY3RpdmVzIjogW10KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIkZpZWxkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIk5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogInBhdGgiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYXJndW1lbnRzIjogW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImRpcmVjdGl2ZXMiOiBbXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiRmllbGQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJuYW1lIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiTmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAibG9jYWxlIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImFyZ3VtZW50cyI6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJkaXJlY3RpdmVzIjogW10KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJGaWVsZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiTmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICJ0b3RhbEhpdHMiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImFyZ3VtZW50cyI6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImRpcmVjdGl2ZXMiOiBbXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1dCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1dCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgIH1dLAogICAgICAgICAgICAgICAgICAgICAgICAgICJsb2MiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAic3RhcnQiOiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImVuZCI6IDQ0OSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzb3VyY2UiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJib2R5IjogIlxuICAgICAgICAgICAgICAgICAgICBxdWVyeSAoJHF1ZXJ5OiBTdHJpbmchLCAkbG9jYWxlOiBTdHJpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICBwYWdlcyB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWFyY2gocXVlcnk6JHF1ZXJ5LCBsb2NhbGU6JGxvY2FsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEhpdHNcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJuYW1lIjogIkdyYXBoUUwgcmVxdWVzdCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJsb2NhdGlvbk9mZnNldCI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibGluZSI6IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImNvbHVtbiI6IDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgdmFyaWFibGVzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnk6IHF1ZXJ5U3RyaW5nLAogICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsZTogX3RoaXM2LmxvY2FsZQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBmZXRjaFBvbGljeTogJ2NhY2hlLWZpcnN0JwogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgICAgICAgcmVzcFJhdyA9IF9jb250ZXh0LnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgICByZXNwID0gX2dldChyZXNwUmF3LCAnZGF0YS5wYWdlcy5zZWFyY2gnLCB7fSk7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoIShyZXNwICYmIHJlc3AudG90YWxIaXRzID4gMCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDExOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGlzdDogcmVzcC5yZXN1bHRzLm1hcChmdW5jdGlvbiAocikgewogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnKCcgKyAoc2l0ZUxhbmdzLmxlbmd0aCA+IDAgPyAiLyIgKyByLmxvY2FsZSArICIvIiArIHIucGF0aCA6ICIvIiArIHIucGF0aCkgKyAnKScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5VGV4dDogc2l0ZUxhbmdzLmxlbmd0aCA+IDAgPyAiLyIgKyByLmxvY2FsZSArICIvIiArIHIucGF0aCArICIgLSAiICsgci50aXRsZSA6ICIvIiArIHIucGF0aCArICIgLSAiICsgci50aXRsZQogICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgICAgICBmcm9tOiBDb2RlTWlycm9yLlBvcyhjdXIubGluZSwgdG9rZW4uc3RhcnQpLAogICAgICAgICAgICAgICAgICAgICAgICB0bzogQ29kZU1pcnJvci5Qb3MoY3VyLmxpbmUsIHRva2VuLmVuZCkKICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTU7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDEzOwogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQudDAgPSBfY29udGV4dFsiY2F0Y2giXSg0KTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgewogICAgICAgICAgICAgICAgICAgICAgICBsaXN0OiBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgZnJvbTogQ29kZU1pcnJvci5Qb3MoY3VyLmxpbmUsIHRva2VuLnN0YXJ0KSwKICAgICAgICAgICAgICAgICAgICAgICAgdG86IENvZGVNaXJyb3IuUG9zKGN1ci5saW5lLCB0b2tlbi5lbmQpCiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCBfY2FsbGVlLCBudWxsLCBbWzQsIDEzXV0pOwogICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICBmdW5jdGlvbiBoaW50KF94LCBfeDIpIHsKICAgICAgICAgICAgICAgIHJldHVybiBfaGludC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gaGludDsKICAgICAgICAgICAgfSgpCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBpbnNlcnRMaW5rOiBmdW5jdGlvbiBpbnNlcnRMaW5rKCkgewogICAgICB0aGlzLmluc2VydExpbmtEaWFsb2cgPSB0cnVlOwogICAgfSwKICAgIGluc2VydExpbmtIYW5kbGVyOiBmdW5jdGlvbiBpbnNlcnRMaW5rSGFuZGxlcihfcmVmNSkgewogICAgICB2YXIgbG9jYWxlID0gX3JlZjUubG9jYWxlLAogICAgICAgIHBhdGggPSBfcmVmNS5wYXRoOwogICAgICB2YXIgbGFzdFBhcnQgPSBfbGFzdChwYXRoLnNwbGl0KCcvJykpOwogICAgICB0aGlzLmluc2VydEF0Q3Vyc29yKHsKICAgICAgICBjb250ZW50OiBzaXRlTGFuZ3MubGVuZ3RoID4gMCA/ICJbIiArIGxhc3RQYXJ0ICsgIl0oLyIgKyBsb2NhbGUgKyAiLyIgKyBwYXRoICsgIikiIDogIlsiICsgbGFzdFBhcnQgKyAiXSgvIiArIHBhdGggKyAiKSIKICAgICAgfSk7CiAgICB9LAogICAgcHJvY2Vzc01hcmtlcnM6IGZ1bmN0aW9uIHByb2Nlc3NNYXJrZXJzKGZyb20sIHRvKSB7CiAgICAgIHZhciBfdGhpczcgPSB0aGlzOwogICAgICB2YXIgZm91bmQgPSBudWxsOwogICAgICB2YXIgZm91bmRTdGFydCA9IDA7CiAgICAgIHRoaXMuY20uZG9jLmdldEFsbE1hcmtzKCkuZm9yRWFjaChmdW5jdGlvbiAobWspIHsKICAgICAgICBpZiAobWsuX19raW5kKSB7CiAgICAgICAgICBtay5jbGVhcigpOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHRoaXMuY20uZWFjaExpbmUoZnJvbSwgdG8sIGZ1bmN0aW9uIChsbikgewogICAgICAgIHZhciBsaW5lID0gbG4ubGluZU5vKCk7CiAgICAgICAgaWYgKGxuLnRleHQuc3RhcnRzV2l0aCgnYGBgZGlhZ3JhbScpKSB7CiAgICAgICAgICBmb3VuZCA9ICdkaWFncmFtJzsKICAgICAgICAgIGZvdW5kU3RhcnQgPSBsaW5lOwogICAgICAgIH0gZWxzZSBpZiAobG4udGV4dCA9PT0gJ2BgYCcgJiYgZm91bmQpIHsKICAgICAgICAgIHN3aXRjaCAoZm91bmQpIHsKICAgICAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgICAgIC8vIC0+IERJQUdSQU0KICAgICAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgICAgIGNhc2UgJ2RpYWdyYW0nOgogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGlmIChsaW5lIC0gZm91bmRTdGFydCAhPT0gMikgewogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBfdGhpczcuYWRkTWFya2VyKHsKICAgICAgICAgICAgICAgICAga2luZDogJ2RpYWdyYW0nLAogICAgICAgICAgICAgICAgICBmcm9tOiB7CiAgICAgICAgICAgICAgICAgICAgbGluZTogZm91bmRTdGFydCwKICAgICAgICAgICAgICAgICAgICBjaDogMwogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICB0bzogewogICAgICAgICAgICAgICAgICAgIGxpbmU6IGZvdW5kU3RhcnQsCiAgICAgICAgICAgICAgICAgICAgY2g6IDEwCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIHRleHQ6ICdFZGl0IERpYWdyYW0nLAogICAgICAgICAgICAgICAgICBhY3Rpb246IGZ1bmN0aW9uIChzdGFydCwgZW5kKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChldikgewogICAgICAgICAgICAgICAgICAgICAgX3RoaXM3LmNtLmRvYy5zZXRTZWxlY3Rpb24oewogICAgICAgICAgICAgICAgICAgICAgICBsaW5lOiBzdGFydCwKICAgICAgICAgICAgICAgICAgICAgICAgY2g6IDAKICAgICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGluZTogZW5kLAogICAgICAgICAgICAgICAgICAgICAgICBjaDogMwogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmF3ID0gX3RoaXM3LmNtLmRvYy5nZXRMaW5lKGVuZCAtIDEpOwogICAgICAgICAgICAgICAgICAgICAgICBfdGhpczcuJHN0b3JlLnNldCgnZWRpdG9yL2FjdGl2ZU1vZGFsRGF0YScsIEJ1ZmZlci5mcm9tKHJhdywgJ2Jhc2U2NCcpLnRvU3RyaW5nKCkpOwogICAgICAgICAgICAgICAgICAgICAgICBfdGhpczcudG9nZ2xlTW9kYWwoImVkaXRvck1vZGFsRHJhd2lvIik7CiAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzNy4kc3RvcmUuY29tbWl0KCdzaG93Tm90aWZpY2F0aW9uJywgewogICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gcHJvY2VzcyBkaWFncmFtIGRhdGEuJywKICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZTogJ3dhcm5pbmcnLAogICAgICAgICAgICAgICAgICAgICAgICAgIGljb246ICd3YXJuaW5nJwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICB9KGZvdW5kU3RhcnQsIGxpbmUpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGlmIChsbi5oZWlnaHQgPiAwKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzNy5jbS5mb2xkQ29kZShmb3VuZFN0YXJ0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGZvdW5kID0gbnVsbDsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGFkZE1hcmtlcjogZnVuY3Rpb24gYWRkTWFya2VyKF9yZWY2KSB7CiAgICAgIHZhciBraW5kID0gX3JlZjYua2luZCwKICAgICAgICBmcm9tID0gX3JlZjYuZnJvbSwKICAgICAgICB0byA9IF9yZWY2LnRvLAogICAgICAgIHRleHQgPSBfcmVmNi50ZXh0LAogICAgICAgIGFjdGlvbiA9IF9yZWY2LmFjdGlvbjsKICAgICAgdmFyIG1hcmtlckVsbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTsKICAgICAgbWFya2VyRWxtLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHRleHQpKTsKICAgICAgbWFya2VyRWxtLmNsYXNzTmFtZSA9ICdDb2RlTWlycm9yLWJ1dHRvbm1hcmtlcic7CiAgICAgIG1hcmtlckVsbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFjdGlvbik7CiAgICAgIHRoaXMuY20ubWFya1RleHQoZnJvbSwgdG8sIHsKICAgICAgICByZXBsYWNlZFdpdGg6IG1hcmtlckVsbSwKICAgICAgICBfX2tpbmQ6IGtpbmQKICAgICAgfSk7CiAgICB9CiAgfSwKICBtb3VudGVkOiBmdW5jdGlvbiBtb3VudGVkKCkgewogICAgdmFyIF90aGlzOCA9IHRoaXM7CiAgICB0aGlzLiRzdG9yZS5zZXQoJ2VkaXRvci9lZGl0b3JLZXknLCAnbWFya2Rvd24nKTsKICAgIGlmICh0aGlzLm1vZGUgPT09ICdjcmVhdGUnICYmICF0aGlzLiRzdG9yZS5nZXQoJ2VkaXRvci9jb250ZW50JykpIHsKICAgICAgdGhpcy4kc3RvcmUuc2V0KCdlZGl0b3IvY29udGVudCcsICcjIEhlYWRlclxuWW91ciBjb250ZW50IGhlcmUnKTsKICAgIH0KCiAgICAvLyBJbml0aWFsaXplIE1lcm1haWQgQVBJCiAgICBtZXJtYWlkLmluaXRpYWxpemUoewogICAgICBzdGFydE9uTG9hZDogZmFsc2UsCiAgICAgIHRoZW1lOiB0aGlzLiR2dWV0aWZ5LnRoZW1lLmRhcmsgPyAiZGFyayIgOiAiZGVmYXVsdCIKICAgIH0pOwoKICAgIC8vIEluaXRpYWxpemUgQ29kZU1pcnJvcgoKICAgIHRoaXMuY20gPSBDb2RlTWlycm9yLmZyb21UZXh0QXJlYSh0aGlzLiRyZWZzLmNtLCB7CiAgICAgIHRhYlNpemU6IDIsCiAgICAgIG1vZGU6ICd0ZXh0L21hcmtkb3duJywKICAgICAgdGhlbWU6ICd3aWtpanMtZGFyaycsCiAgICAgIGxpbmVOdW1iZXJzOiB0cnVlLAogICAgICBsaW5lV3JhcHBpbmc6IHRydWUsCiAgICAgIGxpbmU6IHRydWUsCiAgICAgIHN0eWxlQWN0aXZlTGluZTogdHJ1ZSwKICAgICAgaGlnaGxpZ2h0U2VsZWN0aW9uTWF0Y2hlczogewogICAgICAgIGFubm90YXRlU2Nyb2xsYmFyOiB0cnVlCiAgICAgIH0sCiAgICAgIHZpZXdwb3J0TWFyZ2luOiA1MCwKICAgICAgaW5wdXRTdHlsZTogJ2NvbnRlbnRlZGl0YWJsZScsCiAgICAgIGFsbG93RHJvcEZpbGVUeXBlczogWydpbWFnZS9qcGcnLCAnaW1hZ2UvcG5nJywgJ2ltYWdlL3N2ZycsICdpbWFnZS9qcGVnJywgJ2ltYWdlL2dpZiddLAogICAgICBkaXJlY3Rpb246IHNpdGVDb25maWcucnRsID8gJ3J0bCcgOiAnbHRyJywKICAgICAgZm9sZEd1dHRlcjogdHJ1ZSwKICAgICAgZ3V0dGVyczogWydDb2RlTWlycm9yLWxpbmVudW1iZXJzJywgJ0NvZGVNaXJyb3ItZm9sZGd1dHRlciddCiAgICB9KTsKICAgIHRoaXMuY20uc2V0VmFsdWUodGhpcy4kc3RvcmUuZ2V0KCdlZGl0b3IvY29udGVudCcpKTsKICAgIHRoaXMuY20ub24oJ2NoYW5nZScsIGZ1bmN0aW9uIChjKSB7CiAgICAgIF90aGlzOC4kc3RvcmUuc2V0KCdlZGl0b3IvY29udGVudCcsIGMuZ2V0VmFsdWUoKSk7CiAgICAgIF90aGlzOC5vbkNtSW5wdXQoX3RoaXM4LiRzdG9yZS5nZXQoJ2VkaXRvci9jb250ZW50JykpOwogICAgfSk7CiAgICBpZiAodGhpcy4kdnVldGlmeS5icmVha3BvaW50Lm1kQW5kVXApIHsKICAgICAgdGhpcy5jbS5zZXRTaXplKG51bGwsICdjYWxjKDEwMHZoIC0gMTEycHggLSAyNHB4KScpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5jbS5zZXRTaXplKG51bGwsICdjYWxjKDEwMHZoIC0gMTEycHggLSAxNnB4KScpOwogICAgfQoKICAgIC8vIFNldCBLZXliaW5kaW5ncwoKICAgIHZhciBrZXlCaW5kaW5ncyA9IHsKICAgICAgJ0YxMSc6IGZ1bmN0aW9uIEYxMShjKSB7CiAgICAgICAgYy5zZXRPcHRpb24oJ2Z1bGxTY3JlZW4nLCAhYy5nZXRPcHRpb24oJ2Z1bGxTY3JlZW4nKSk7CiAgICAgIH0sCiAgICAgICdFc2MnOiBmdW5jdGlvbiBFc2MoYykgewogICAgICAgIGlmIChjLmdldE9wdGlvbignZnVsbFNjcmVlbicpKSBjLnNldE9wdGlvbignZnVsbFNjcmVlbicsIGZhbHNlKTsKICAgICAgfQogICAgfTsKICAgIF9zZXQoa2V5QmluZGluZ3MsIEN0cmxLZXkgKyAiLVMiLCBmdW5jdGlvbiAoYykgewogICAgICBfdGhpczguc2F2ZSgpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9KTsKICAgIF9zZXQoa2V5QmluZGluZ3MsIEN0cmxLZXkgKyAiLUIiLCBmdW5jdGlvbiAoYykgewogICAgICBfdGhpczgudG9nZ2xlTWFya3VwKHsKICAgICAgICBzdGFydDogIioqIgogICAgICB9KTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSk7CiAgICBfc2V0KGtleUJpbmRpbmdzLCBDdHJsS2V5ICsgIi1JIiwgZnVuY3Rpb24gKGMpIHsKICAgICAgX3RoaXM4LnRvZ2dsZU1hcmt1cCh7CiAgICAgICAgc3RhcnQ6ICIqIgogICAgICB9KTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSk7CiAgICBfc2V0KGtleUJpbmRpbmdzLCBDdHJsS2V5ICsgIi1BbHQtUmlnaHQiLCBmdW5jdGlvbiAoYykgewogICAgICB2YXIgbHZsID0gX3RoaXM4LmdldEhlYWRlckxldmVsKGMpOwogICAgICBpZiAobHZsID49IDYpIHsKICAgICAgICBsdmwgPSA1OwogICAgICB9CiAgICAgIF90aGlzOC5zZXRIZWFkZXJMaW5lKGx2bCArIDEpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9KTsKICAgIF9zZXQoa2V5QmluZGluZ3MsIEN0cmxLZXkgKyAiLUFsdC1MZWZ0IiwgZnVuY3Rpb24gKGMpIHsKICAgICAgdmFyIGx2bCA9IF90aGlzOC5nZXRIZWFkZXJMZXZlbChjKTsKICAgICAgaWYgKGx2bCA8PSAxKSB7CiAgICAgICAgbHZsID0gMjsKICAgICAgfQogICAgICBfdGhpczguc2V0SGVhZGVyTGluZShsdmwgLSAxKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSk7CiAgICB0aGlzLmNtLnNldE9wdGlvbignZXh0cmFLZXlzJywga2V5QmluZGluZ3MpOwogICAgdGhpcy5jbS5vbignaW5wdXRSZWFkJywgdGhpcy5hdXRvY29tcGxldGUpOwoKICAgIC8vIEhhbmRsZSBjdXJzb3IgbW92ZW1lbnQKCiAgICB0aGlzLmNtLm9uKCdjdXJzb3JBY3Rpdml0eScsIGZ1bmN0aW9uIChjKSB7CiAgICAgIF90aGlzOC5wb3NpdGlvblN5bmMoYyk7CiAgICAgIF90aGlzOC5zY3JvbGxTeW5jKGMpOwogICAgfSk7CgogICAgLy8gSGFuZGxlIHNwZWNpYWwgcGFzdGUKCiAgICB0aGlzLmNtLm9uKCdwYXN0ZScsIHRoaXMub25DbVBhc3RlKTsKCiAgICAvLyBSZW5kZXIgaW5pdGlhbCBwcmV2aWV3CgogICAgdGhpcy5wcm9jZXNzQ29udGVudCh0aGlzLiRzdG9yZS5nZXQoJ2VkaXRvci9jb250ZW50JykpOwogICAgdGhpcy5yZWZyZXNoKCk7CiAgICB0aGlzLiRyb290LiRvbignZWRpdG9ySW5zZXJ0JywgZnVuY3Rpb24gKG9wdHMpIHsKICAgICAgc3dpdGNoIChvcHRzLmtpbmQpIHsKICAgICAgICBjYXNlICdJTUFHRSc6CiAgICAgICAgICB2YXIgaW1nID0gIiFbIiArIG9wdHMudGV4dCArICJdKCIgKyBvcHRzLnBhdGggKyAiKSI7CiAgICAgICAgICBpZiAob3B0cy5hbGlnbiAmJiBvcHRzLmFsaWduICE9PSAnJykgewogICAgICAgICAgICBpbWcgKz0gInsuYWxpZ24tIiArIG9wdHMuYWxpZ24gKyAifSI7CiAgICAgICAgICB9CiAgICAgICAgICBfdGhpczguaW5zZXJ0QXRDdXJzb3IoewogICAgICAgICAgICBjb250ZW50OiBpbWcKICAgICAgICAgIH0pOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnQklOQVJZJzoKICAgICAgICAgIF90aGlzOC5pbnNlcnRBdEN1cnNvcih7CiAgICAgICAgICAgIGNvbnRlbnQ6ICJbIiArIG9wdHMudGV4dCArICJdKCIgKyBvcHRzLnBhdGggKyAiKSIKICAgICAgICAgIH0pOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnRElBR1JBTSc6CiAgICAgICAgICB2YXIgc2VsU3RhcnRMaW5lID0gX3RoaXM4LmNtLmdldEN1cnNvcignZnJvbScpLmxpbmU7CiAgICAgICAgICB2YXIgc2VsRW5kTGluZSA9IF90aGlzOC5jbS5nZXRDdXJzb3IoJ3RvJykubGluZSArIDE7CiAgICAgICAgICBfdGhpczguY20uZG9jLnJlcGxhY2VTZWxlY3Rpb24oJ2BgYGRpYWdyYW1cbicgKyBvcHRzLnRleHQgKyAnXG5gYGBcbicsICdzdGFydCcpOwogICAgICAgICAgX3RoaXM4LnByb2Nlc3NNYXJrZXJzKHNlbFN0YXJ0TGluZSwgc2VsRW5kTGluZSk7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfSk7CgogICAgLy8gSGFuZGxlIHNhdmUgY29uZmxpY3QKICAgIHRoaXMuJHJvb3QuJG9uKCdzYXZlQ29uZmxpY3QnLCBmdW5jdGlvbiAoKSB7CiAgICAgIF90aGlzOC50b2dnbGVNb2RhbCgiZWRpdG9yTW9kYWxDb25mbGljdCIpOwogICAgfSk7CiAgICB0aGlzLiRyb290LiRvbignb3ZlcndyaXRlRWRpdG9yQ29udGVudCcsIGZ1bmN0aW9uICgpIHsKICAgICAgX3RoaXM4LmNtLnNldFZhbHVlKF90aGlzOC4kc3RvcmUuZ2V0KCdlZGl0b3IvY29udGVudCcpKTsKICAgIH0pOwogIH0sCiAgYmVmb3JlRGVzdHJveTogZnVuY3Rpb24gYmVmb3JlRGVzdHJveSgpIHsKICAgIHRoaXMuJHJvb3QuJG9mZignZWRpdG9ySW5zZXJ0Jyk7CiAgfQp9Ow=="},null]}