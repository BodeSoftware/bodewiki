{"remainingRequest":"/Users/shanebeal/Desktop/bodewiki/node_modules/babel-loader/lib/index.js??ref--0-1!/Users/shanebeal/Desktop/bodewiki/node_modules/webpack-modernizr-loader/index.js!/Users/shanebeal/Desktop/bodewiki/client/.modernizrrc.js","dependencies":[{"path":"/Users/shanebeal/Desktop/bodewiki/client/.modernizrrc.js","mtime":1742769082000},{"path":"/Users/shanebeal/Desktop/bodewiki/.babelrc","mtime":1742797763162},{"path":"/Users/shanebeal/Desktop/bodewiki/node_modules/cache-loader/dist/cjs.js","mtime":1742846258556},{"path":"/Users/shanebeal/Desktop/bodewiki/node_modules/babel-loader/lib/index.js","mtime":1742846259254},{"path":"/Users/shanebeal/Desktop/bodewiki/node_modules/webpack-modernizr-loader/index.js","mtime":1742846258549}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:OwooZnVuY3Rpb24gKHdpbmRvdykgewogIHZhciBoYWRHbG9iYWwgPSAnTW9kZXJuaXpyJyBpbiB3aW5kb3c7CiAgdmFyIG9sZEdsb2JhbCA9IHdpbmRvdy5Nb2Rlcm5penI7IC8qIQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIG1vZGVybml6ciB2My4xMy4xCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQnVpbGQgaHR0cHM6Ly9tb2Rlcm5penIuY29tL2Rvd25sb2FkPy1iYWNrZHJvcGZpbHRlci1zZXRjbGFzc2VzLWRvbnRtaW4tY3NzY2xhc3NwcmVmaXg6bWR6LQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQ29weXJpZ2h0IChjKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqICBGYXJ1ayBBdGVzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogIFBhdWwgSXJpc2gKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiAgQWxleCBTZXh0b24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiAgUnlhbiBTZWRkb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiAgUGF0cmljayBLZXR0bmVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogIFN0dSBDb3gKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiAgUmljaGFyZCBIZXJyZXJhCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogIFZlZWNrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogTUlUIExpY2Vuc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi8KCiAgLyoKICAgKiBNb2Rlcm5penIgdGVzdHMgd2hpY2ggbmF0aXZlIENTUzMgYW5kIEhUTUw1IGZlYXR1cmVzIGFyZSBhdmFpbGFibGUgaW4gdGhlCiAgICogY3VycmVudCBVQSBhbmQgbWFrZXMgdGhlIHJlc3VsdHMgYXZhaWxhYmxlIHRvIHlvdSBpbiB0d28gd2F5czogYXMgcHJvcGVydGllcyBvbgogICAqIGEgZ2xvYmFsIGBNb2Rlcm5penJgIG9iamVjdCwgYW5kIGFzIGNsYXNzZXMgb24gdGhlIGA8aHRtbD5gIGVsZW1lbnQuIFRoaXMKICAgKiBpbmZvcm1hdGlvbiBhbGxvd3MgeW91IHRvIHByb2dyZXNzaXZlbHkgZW5oYW5jZSB5b3VyIHBhZ2VzIHdpdGggYSBncmFudWxhciBsZXZlbAogICAqIG9mIGNvbnRyb2wgb3ZlciB0aGUgZXhwZXJpZW5jZS4KICAqLwoKICA7CiAgKGZ1bmN0aW9uIChzY3JpcHRHbG9iYWxPYmplY3QsIHdpbmRvdywgZG9jdW1lbnQsIHVuZGVmaW5lZCkgewogICAgdmFyIHRlc3RzID0gW107CgogICAgLyoqCiAgICAgKiBNb2Rlcm5penJQcm90byBpcyB0aGUgY29uc3RydWN0b3IgZm9yIE1vZGVybml6cgogICAgICoKICAgICAqIEBjbGFzcwogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqLwogICAgdmFyIE1vZGVybml6clByb3RvID0gewogICAgICBfdmVyc2lvbjogJzMuMTMuMScsCiAgICAgIC8vIEFueSBzZXR0aW5ncyB0aGF0IGRvbid0IHdvcmsgYXMgc2VwYXJhdGUgbW9kdWxlcwogICAgICAvLyBjYW4gZ28gaW4gaGVyZSBhcyBjb25maWd1cmF0aW9uLgogICAgICBfY29uZmlnOiB7CiAgICAgICAgJ2NsYXNzUHJlZml4JzogJ21kei0nLAogICAgICAgICdlbmFibGVDbGFzc2VzJzogdHJ1ZSwKICAgICAgICAnZW5hYmxlSlNDbGFzcyc6IHRydWUsCiAgICAgICAgJ3VzZVByZWZpeGVzJzogdHJ1ZQogICAgICB9LAogICAgICAvLyBRdWV1ZSBvZiB0ZXN0cwogICAgICBfcTogW10sCiAgICAgIC8vIFN0dWIgdGhlc2UgZm9yIHBlb3BsZSB3aG8gYXJlIGxpc3RlbmluZwogICAgICBvbjogZnVuY3Rpb24gb24odGVzdCwgY2IpIHsKICAgICAgICAvLyBJIGRvbid0IHJlYWxseSB0aGluayBwZW9wbGUgc2hvdWxkIGRvIHRoaXMsIGJ1dCB3ZSBjYW4KICAgICAgICAvLyBzYWZlIGd1YXJkIGl0IGEgYml0LgogICAgICAgIC8vIC0tIE5PVEU6OiB0aGlzIGdldHMgV0FZIG92ZXJyaWRkZW4gaW4gc3JjL2FkZFRlc3QgZm9yIGFjdHVhbCBhc3luYyB0ZXN0cy4KICAgICAgICAvLyBUaGlzIGlzIGluIGNhc2UgcGVvcGxlIGxpc3RlbiB0byBzeW5jaHJvbm91cyB0ZXN0cy4gSSB3b3VsZCBsZWF2ZSBpdCBvdXQsCiAgICAgICAgLy8gYnV0IHRoZSBjb2RlIHRvICpkaXNhbGxvdyogc3luYyB0ZXN0cyBpbiB0aGUgcmVhbCB2ZXJzaW9uIG9mIHRoaXMKICAgICAgICAvLyBmdW5jdGlvbiBpcyBhY3R1YWxseSBsYXJnZXIgdGhhbiB0aGlzLgogICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGNiKHNlbGZbdGVzdF0pOwogICAgICAgIH0sIDApOwogICAgICB9LAogICAgICBhZGRUZXN0OiBmdW5jdGlvbiBhZGRUZXN0KG5hbWUsIGZuLCBvcHRpb25zKSB7CiAgICAgICAgdGVzdHMucHVzaCh7CiAgICAgICAgICBuYW1lOiBuYW1lLAogICAgICAgICAgZm46IGZuLAogICAgICAgICAgb3B0aW9uczogb3B0aW9ucwogICAgICAgIH0pOwogICAgICB9LAogICAgICBhZGRBc3luY1Rlc3Q6IGZ1bmN0aW9uIGFkZEFzeW5jVGVzdChmbikgewogICAgICAgIHRlc3RzLnB1c2goewogICAgICAgICAgbmFtZTogbnVsbCwKICAgICAgICAgIGZuOiBmbgogICAgICAgIH0pOwogICAgICB9CiAgICB9OwoKICAgIC8vIEZha2Ugc29tZSBvZiBPYmplY3QuY3JlYXRlIHNvIHdlIGNhbiBmb3JjZSBub24gdGVzdCByZXN1bHRzIHRvIGJlIG5vbiAib3duIiBwcm9wZXJ0aWVzLgogICAgdmFyIE1vZGVybml6ciA9IGZ1bmN0aW9uIE1vZGVybml6cigpIHt9OwogICAgTW9kZXJuaXpyLnByb3RvdHlwZSA9IE1vZGVybml6clByb3RvOwoKICAgIC8vIExlYWsgbW9kZXJuaXpyIGdsb2JhbGx5IHdoZW4geW91IGByZXF1aXJlYCBpdCByYXRoZXIgdGhhbiBmb3JjZSBpdCBoZXJlLgogICAgLy8gT3ZlcndyaXRlIG5hbWUgc28gY29uc3RydWN0b3IgbmFtZSBpcyBuaWNlciA6RAogICAgTW9kZXJuaXpyID0gbmV3IE1vZGVybml6cigpOwogICAgdmFyIGNsYXNzZXMgPSBbXTsKCiAgICAvKioKICAgICAqIGlzIHJldHVybnMgYSBib29sZWFuIGlmIHRoZSB0eXBlb2YgYW4gb2JqIGlzIGV4YWN0bHkgdHlwZS4KICAgICAqCiAgICAgKiBAYWNjZXNzIHByaXZhdGUKICAgICAqIEBmdW5jdGlvbiBpcwogICAgICogQHBhcmFtIHsqfSBvYmogLSBBIHRoaW5nIHdlIHdhbnQgdG8gY2hlY2sgdGhlIHR5cGUgb2YKICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlIC0gQSBzdHJpbmcgdG8gY29tcGFyZSB0aGUgdHlwZW9mIGFnYWluc3QKICAgICAqIEByZXR1cm5zIHtib29sZWFufSB0cnVlIGlmIHRoZSB0eXBlb2YgdGhlIGZpcnN0IHBhcmFtZXRlciBpcyBleGFjdGx5IHRoZSBzcGVjaWZpZWQgdHlwZSwgZmFsc2Ugb3RoZXJ3aXNlCiAgICAgKi8KICAgIGZ1bmN0aW9uIGlzKG9iaiwgdHlwZSkgewogICAgICByZXR1cm4gdHlwZW9mIG9iaiA9PT0gdHlwZTsKICAgIH0KICAgIDsKCiAgICAvKioKICAgICAqIFJ1biB0aHJvdWdoIGFsbCB0ZXN0cyBhbmQgZGV0ZWN0IHRoZWlyIHN1cHBvcnQgaW4gdGhlIGN1cnJlbnQgVUEuCiAgICAgKgogICAgICogQGFjY2VzcyBwcml2YXRlCiAgICAgKiBAcmV0dXJucyB7dm9pZH0KICAgICAqLwogICAgZnVuY3Rpb24gdGVzdFJ1bm5lcigpIHsKICAgICAgdmFyIGZlYXR1cmVOYW1lczsKICAgICAgdmFyIGZlYXR1cmU7CiAgICAgIHZhciBhbGlhc0lkeDsKICAgICAgdmFyIHJlc3VsdDsKICAgICAgdmFyIG5hbWVJZHg7CiAgICAgIHZhciBmZWF0dXJlTmFtZTsKICAgICAgdmFyIGZlYXR1cmVOYW1lU3BsaXQ7CiAgICAgIGZvciAodmFyIGZlYXR1cmVJZHggaW4gdGVzdHMpIHsKICAgICAgICBpZiAodGVzdHMuaGFzT3duUHJvcGVydHkoZmVhdHVyZUlkeCkpIHsKICAgICAgICAgIGZlYXR1cmVOYW1lcyA9IFtdOwogICAgICAgICAgZmVhdHVyZSA9IHRlc3RzW2ZlYXR1cmVJZHhdOwogICAgICAgICAgLy8gcnVuIHRoZSB0ZXN0LCB0aHJvdyB0aGUgcmV0dXJuIHZhbHVlIGludG8gdGhlIE1vZGVybml6ciwKICAgICAgICAgIC8vIHRoZW4gYmFzZWQgb24gdGhhdCBib29sZWFuLCBkZWZpbmUgYW4gYXBwcm9wcmlhdGUgY2xhc3NOYW1lCiAgICAgICAgICAvLyBhbmQgcHVzaCBpdCBpbnRvIGFuIGFycmF5IG9mIGNsYXNzZXMgd2UnbGwgam9pbiBsYXRlci4KICAgICAgICAgIC8vCiAgICAgICAgICAvLyBJZiB0aGVyZSBpcyBubyBuYW1lLCBpdCdzIGFuICdhc3luYycgdGVzdCB0aGF0IGlzIHJ1biwKICAgICAgICAgIC8vIGJ1dCBub3QgZGlyZWN0bHkgYWRkZWQgdG8gdGhlIG9iamVjdC4gVGhhdCBzaG91bGQKICAgICAgICAgIC8vIGJlIGRvbmUgd2l0aCBhIHBvc3QtcnVuIGFkZFRlc3QgY2FsbC4KICAgICAgICAgIGlmIChmZWF0dXJlLm5hbWUpIHsKICAgICAgICAgICAgZmVhdHVyZU5hbWVzLnB1c2goZmVhdHVyZS5uYW1lLnRvTG93ZXJDYXNlKCkpOwogICAgICAgICAgICBpZiAoZmVhdHVyZS5vcHRpb25zICYmIGZlYXR1cmUub3B0aW9ucy5hbGlhc2VzICYmIGZlYXR1cmUub3B0aW9ucy5hbGlhc2VzLmxlbmd0aCkgewogICAgICAgICAgICAgIC8vIEFkZCBhbGwgdGhlIGFsaWFzZXMgaW50byB0aGUgbmFtZXMgbGlzdAogICAgICAgICAgICAgIGZvciAoYWxpYXNJZHggPSAwOyBhbGlhc0lkeCA8IGZlYXR1cmUub3B0aW9ucy5hbGlhc2VzLmxlbmd0aDsgYWxpYXNJZHgrKykgewogICAgICAgICAgICAgICAgZmVhdHVyZU5hbWVzLnB1c2goZmVhdHVyZS5vcHRpb25zLmFsaWFzZXNbYWxpYXNJZHhdLnRvTG93ZXJDYXNlKCkpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIC8vIFJ1biB0aGUgdGVzdCwgb3IgdXNlIHRoZSByYXcgdmFsdWUgaWYgaXQncyBub3QgYSBmdW5jdGlvbgogICAgICAgICAgcmVzdWx0ID0gaXMoZmVhdHVyZS5mbiwgJ2Z1bmN0aW9uJykgPyBmZWF0dXJlLmZuKCkgOiBmZWF0dXJlLmZuOwoKICAgICAgICAgIC8vIFNldCBlYWNoIG9mIHRoZSBuYW1lcyBvbiB0aGUgTW9kZXJuaXpyIG9iamVjdAogICAgICAgICAgZm9yIChuYW1lSWR4ID0gMDsgbmFtZUlkeCA8IGZlYXR1cmVOYW1lcy5sZW5ndGg7IG5hbWVJZHgrKykgewogICAgICAgICAgICBmZWF0dXJlTmFtZSA9IGZlYXR1cmVOYW1lc1tuYW1lSWR4XTsKICAgICAgICAgICAgLy8gU3VwcG9ydCBkb3QgcHJvcGVydGllcyBhcyBzdWIgdGVzdHMuIFdlIGRvbid0IGRvIGNoZWNraW5nIHRvIG1ha2Ugc3VyZQogICAgICAgICAgICAvLyB0aGF0IHRoZSBpbXBsaWVkIHBhcmVudCB0ZXN0cyBoYXZlIGJlZW4gYWRkZWQuIFlvdSBtdXN0IGNhbGwgdGhlbSBpbgogICAgICAgICAgICAvLyBvcmRlciAoZWl0aGVyIGluIHRoZSB0ZXN0LCBvciBtYWtlIHRoZSBwYXJlbnQgdGVzdCBhIGRlcGVuZGVuY3kpLgogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyBDYXAgaXQgdG8gVFdPIHRvIG1ha2UgdGhlIGxvZ2ljIHNpbXBsZSBhbmQgYmVjYXVzZSB3aG8gbmVlZHMgdGhhdCBraW5kIG9mIHN1YnRlc3RpbmcKICAgICAgICAgICAgLy8gaGFzaHRhZyBmYW1vdXMgbGFzdCB3b3JkcwogICAgICAgICAgICBmZWF0dXJlTmFtZVNwbGl0ID0gZmVhdHVyZU5hbWUuc3BsaXQoJy4nKTsKICAgICAgICAgICAgaWYgKGZlYXR1cmVOYW1lU3BsaXQubGVuZ3RoID09PSAxKSB7CiAgICAgICAgICAgICAgTW9kZXJuaXpyW2ZlYXR1cmVOYW1lU3BsaXRbMF1dID0gcmVzdWx0OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIC8vIGNhc3QgdG8gYSBCb29sZWFuLCBpZiBub3Qgb25lIGFscmVhZHkgb3IgaWYgaXQgZG9lc250IGV4aXN0IHlldCAobGlrZSBpbnB1dHR5cGVzKQogICAgICAgICAgICAgIGlmICghTW9kZXJuaXpyW2ZlYXR1cmVOYW1lU3BsaXRbMF1dIHx8IE1vZGVybml6cltmZWF0dXJlTmFtZVNwbGl0WzBdXSAmJiAhKE1vZGVybml6cltmZWF0dXJlTmFtZVNwbGl0WzBdXSBpbnN0YW5jZW9mIEJvb2xlYW4pKSB7CiAgICAgICAgICAgICAgICBNb2Rlcm5penJbZmVhdHVyZU5hbWVTcGxpdFswXV0gPSBuZXcgQm9vbGVhbihNb2Rlcm5penJbZmVhdHVyZU5hbWVTcGxpdFswXV0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBNb2Rlcm5penJbZmVhdHVyZU5hbWVTcGxpdFswXV1bZmVhdHVyZU5hbWVTcGxpdFsxXV0gPSByZXN1bHQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2xhc3Nlcy5wdXNoKChyZXN1bHQgPyAnJyA6ICduby0nKSArIGZlYXR1cmVOYW1lU3BsaXQuam9pbignLScpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIDsKCiAgICAvKioKICAgICAqIGRvY0VsZW1lbnQgaXMgYSBjb252ZW5pZW5jZSB3cmFwcGVyIHRvIGdyYWIgdGhlIHJvb3QgZWxlbWVudCBvZiB0aGUgZG9jdW1lbnQKICAgICAqCiAgICAgKiBAYWNjZXNzIHByaXZhdGUKICAgICAqIEByZXR1cm5zIHtIVE1MRWxlbWVudHxTVkdFbGVtZW50fSBUaGUgcm9vdCBlbGVtZW50IG9mIHRoZSBkb2N1bWVudAogICAgICovCiAgICB2YXIgZG9jRWxlbWVudCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsKCiAgICAvKioKICAgICAqIEEgY29udmVuaWVuY2UgaGVscGVyIHRvIGNoZWNrIGlmIHRoZSBkb2N1bWVudCB3ZSBhcmUgcnVubmluZyBpbiBpcyBhbiBTVkcgZG9jdW1lbnQKICAgICAqCiAgICAgKiBAYWNjZXNzIHByaXZhdGUKICAgICAqIEByZXR1cm5zIHtib29sZWFufQogICAgICovCiAgICB2YXIgaXNTVkcgPSBkb2NFbGVtZW50Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICdzdmcnOwoKICAgIC8qKgogICAgICogc2V0Q2xhc3NlcyB0YWtlcyBhbiBhcnJheSBvZiBjbGFzcyBuYW1lcyBhbmQgYWRkcyB0aGVtIHRvIHRoZSByb290IGVsZW1lbnQKICAgICAqCiAgICAgKiBAYWNjZXNzIHByaXZhdGUKICAgICAqIEBmdW5jdGlvbiBzZXRDbGFzc2VzCiAgICAgKiBAcGFyYW0ge3N0cmluZ1tdfSBjbGFzc2VzIC0gQXJyYXkgb2YgY2xhc3MgbmFtZXMKICAgICAqLwogICAgLy8gUGFzcyBpbiBhbiBhbmQgYXJyYXkgb2YgY2xhc3MgbmFtZXMsIGUuZy46CiAgICAvLyAgWyduby13ZWJwJywgJ2JvcmRlcnJhZGl1cycsIC4uLl0KICAgIGZ1bmN0aW9uIHNldENsYXNzZXMoY2xhc3NlcykgewogICAgICB2YXIgY2xhc3NOYW1lID0gZG9jRWxlbWVudC5jbGFzc05hbWU7CiAgICAgIHZhciBjbGFzc1ByZWZpeCA9IE1vZGVybml6ci5fY29uZmlnLmNsYXNzUHJlZml4IHx8ICcnOwogICAgICBpZiAoaXNTVkcpIHsKICAgICAgICBjbGFzc05hbWUgPSBjbGFzc05hbWUuYmFzZVZhbDsKICAgICAgfQoKICAgICAgLy8gQ2hhbmdlIGBuby1qc2AgdG8gYGpzYCAoaW5kZXBlbmRlbnRseSBvZiB0aGUgYGVuYWJsZUNsYXNzZXNgIG9wdGlvbikKICAgICAgLy8gSGFuZGxlIGNsYXNzUHJlZml4IG9uIHRoaXMgdG9vCiAgICAgIGlmIChNb2Rlcm5penIuX2NvbmZpZy5lbmFibGVKU0NsYXNzKSB7CiAgICAgICAgdmFyIHJlSlMgPSBuZXcgUmVnRXhwKCcoXnxcXHMpJyArIGNsYXNzUHJlZml4ICsgJ25vLWpzKFxcc3wkKScpOwogICAgICAgIGNsYXNzTmFtZSA9IGNsYXNzTmFtZS5yZXBsYWNlKHJlSlMsICckMScgKyBjbGFzc1ByZWZpeCArICdqcyQyJyk7CiAgICAgIH0KICAgICAgaWYgKE1vZGVybml6ci5fY29uZmlnLmVuYWJsZUNsYXNzZXMpIHsKICAgICAgICAvLyBBZGQgdGhlIG5ldyBjbGFzc2VzCiAgICAgICAgaWYgKGNsYXNzZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgY2xhc3NOYW1lICs9ICcgJyArIGNsYXNzUHJlZml4ICsgY2xhc3Nlcy5qb2luKCcgJyArIGNsYXNzUHJlZml4KTsKICAgICAgICB9CiAgICAgICAgaWYgKGlzU1ZHKSB7CiAgICAgICAgICBkb2NFbGVtZW50LmNsYXNzTmFtZS5iYXNlVmFsID0gY2xhc3NOYW1lOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBkb2NFbGVtZW50LmNsYXNzTmFtZSA9IGNsYXNzTmFtZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIDsKCiAgICAvKioKICAgICAqIElmIHRoZSBicm93c2VycyBmb2xsb3cgdGhlIHNwZWMsIHRoZW4gdGhleSB3b3VsZCBleHBvc2UgdmVuZG9yLXNwZWNpZmljIHN0eWxlcyBhczoKICAgICAqICAgZWxlbS5zdHlsZS5XZWJraXRCb3JkZXJSYWRpdXMKICAgICAqIGluc3RlYWQgb2Ygc29tZXRoaW5nIGxpa2UgdGhlIGZvbGxvd2luZyAod2hpY2ggaXMgdGVjaG5pY2FsbHkgaW5jb3JyZWN0KToKICAgICAqICAgZWxlbS5zdHlsZS53ZWJraXRCb3JkZXJSYWRpdXMKICAgICAqCiAgICAgKiBXZWJLaXQgZ2hvc3RzIHRoZWlyIHByb3BlcnRpZXMgaW4gbG93ZXJjYXNlIGJ1dCBPcGVyYSAmIE1veiBkbyBub3QuCiAgICAgKiBNaWNyb3NvZnQgdXNlcyBhIGxvd2VyY2FzZSBgbXNgIGluc3RlYWQgb2YgdGhlIGNvcnJlY3QgYE1zYCBpbiBJRTgrCiAgICAgKiAgIGVyaWsuZWFlLm5ldC9hcmNoaXZlcy8yMDA4LzAzLzEwLzIxLjQ4LjEwLwogICAgICoKICAgICAqIE1vcmUgaGVyZTogZ2l0aHViLmNvbS9Nb2Rlcm5penIvTW9kZXJuaXpyL2lzc3Vlcy9pc3N1ZS8yMQogICAgICoKICAgICAqIEBhY2Nlc3MgcHJpdmF0ZQogICAgICogQHJldHVybnMge3N0cmluZ30gVGhlIHN0cmluZyByZXByZXNlbnRpbmcgdGhlIHZlbmRvci1zcGVjaWZpYyBzdHlsZSBwcm9wZXJ0aWVzCiAgICAgKi8KICAgIHZhciBvbVByZWZpeGVzID0gJ01veiBPIG1zIFdlYmtpdCc7CiAgICB2YXIgY3Nzb21QcmVmaXhlcyA9IE1vZGVybml6clByb3RvLl9jb25maWcudXNlUHJlZml4ZXMgPyBvbVByZWZpeGVzLnNwbGl0KCcgJykgOiBbXTsKICAgIE1vZGVybml6clByb3RvLl9jc3NvbVByZWZpeGVzID0gY3Nzb21QcmVmaXhlczsKCiAgICAvKioKICAgICAqIGNvbnRhaW5zIGNoZWNrcyB0byBzZWUgaWYgYSBzdHJpbmcgY29udGFpbnMgYW5vdGhlciBzdHJpbmcKICAgICAqCiAgICAgKiBAYWNjZXNzIHByaXZhdGUKICAgICAqIEBmdW5jdGlvbiBjb250YWlucwogICAgICogQHBhcmFtIHtzdHJpbmd9IHN0ciAtIFRoZSBzdHJpbmcgd2Ugd2FudCB0byBjaGVjayBmb3Igc3Vic3RyaW5ncwogICAgICogQHBhcmFtIHtzdHJpbmd9IHN1YnN0ciAtIFRoZSBzdWJzdHJpbmcgd2Ugd2FudCB0byBzZWFyY2ggdGhlIGZpcnN0IHN0cmluZyBmb3IKICAgICAqIEByZXR1cm5zIHtib29sZWFufSB0cnVlIGlmIGFuZCBvbmx5IGlmIHRoZSBmaXJzdCBzdHJpbmcgJ3N0cicgY29udGFpbnMgdGhlIHNlY29uZCBzdHJpbmcgJ3N1YnN0cicKICAgICAqLwogICAgZnVuY3Rpb24gY29udGFpbnMoc3RyLCBzdWJzdHIpIHsKICAgICAgcmV0dXJuICEhfignJyArIHN0cikuaW5kZXhPZihzdWJzdHIpOwogICAgfQogICAgOwoKICAgIC8qKgogICAgICogY3JlYXRlRWxlbWVudCBpcyBhIGNvbnZlbmllbmNlIHdyYXBwZXIgYXJvdW5kIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQuIFNpbmNlIHdlCiAgICAgKiB1c2UgY3JlYXRlRWxlbWVudCBhbGwgb3ZlciB0aGUgcGxhY2UsIHRoaXMgYWxsb3dzIGZvciAoc2xpZ2h0bHkpIHNtYWxsZXIgY29kZQogICAgICogYXMgd2VsbCBhcyBhYnN0cmFjdGluZyBhd2F5IGlzc3VlcyB3aXRoIGNyZWF0aW5nIGVsZW1lbnRzIGluIGNvbnRleHRzIG90aGVyIHRoYW4KICAgICAqIEhUTUwgZG9jdW1lbnRzIChlLmcuIFNWRyBkb2N1bWVudHMpLgogICAgICoKICAgICAqIEBhY2Nlc3MgcHJpdmF0ZQogICAgICogQGZ1bmN0aW9uIGNyZWF0ZUVsZW1lbnQKICAgICAqIEByZXR1cm5zIHtIVE1MRWxlbWVudHxTVkdFbGVtZW50fSBBbiBIVE1MIG9yIFNWRyBlbGVtZW50CiAgICAgKi8KICAgIGZ1bmN0aW9uIGNyZWF0ZUVsZW1lbnQoKSB7CiAgICAgIGlmICh0eXBlb2YgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCAhPT0gJ2Z1bmN0aW9uJykgewogICAgICAgIC8vIFRoaXMgaXMgdGhlIGNhc2UgaW4gSUU3LCB3aGVyZSB0aGUgdHlwZSBvZiBjcmVhdGVFbGVtZW50IGlzICJvYmplY3QiLgogICAgICAgIC8vIEZvciB0aGlzIHJlYXNvbiwgd2UgY2Fubm90IGNhbGwgYXBwbHkoKSBhcyBPYmplY3QgaXMgbm90IGEgRnVuY3Rpb24uCiAgICAgICAgcmV0dXJuIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoYXJndW1lbnRzWzBdKTsKICAgICAgfSBlbHNlIGlmIChpc1NWRykgewogICAgICAgIHJldHVybiBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMuY2FsbChkb2N1bWVudCwgJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywgYXJndW1lbnRzWzBdKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudC5hcHBseShkb2N1bWVudCwgYXJndW1lbnRzKTsKICAgICAgfQogICAgfQogICAgOwoKICAgIC8qKgogICAgICogQ3JlYXRlIG91ciAibW9kZXJuaXpyIiBlbGVtZW50IHRoYXQgd2UgZG8gbW9zdCBmZWF0dXJlIHRlc3RzIG9uLgogICAgICoKICAgICAqIEBhY2Nlc3MgcHJpdmF0ZQogICAgICovCiAgICB2YXIgbW9kRWxlbSA9IHsKICAgICAgZWxlbTogY3JlYXRlRWxlbWVudCgnbW9kZXJuaXpyJykKICAgIH07CgogICAgLy8gQ2xlYW4gdXAgdGhpcyBlbGVtZW50CiAgICBNb2Rlcm5penIuX3EucHVzaChmdW5jdGlvbiAoKSB7CiAgICAgIGRlbGV0ZSBtb2RFbGVtLmVsZW07CiAgICB9KTsKICAgIHZhciBtU3R5bGUgPSB7CiAgICAgIHN0eWxlOiBtb2RFbGVtLmVsZW0uc3R5bGUKICAgIH07CgogICAgLy8ga2lsbCByZWYgZm9yIGdjLCBtdXN0IGhhcHBlbiBiZWZvcmUgbW9kLmVsZW0gaXMgcmVtb3ZlZCwgc28gd2UgdW5zaGlmdCBvbiB0bwogICAgLy8gdGhlIGZyb250IG9mIHRoZSBxdWV1ZS4KICAgIE1vZGVybml6ci5fcS51bnNoaWZ0KGZ1bmN0aW9uICgpIHsKICAgICAgZGVsZXRlIG1TdHlsZS5zdHlsZTsKICAgIH0pOwoKICAgIC8qKgogICAgICogZ2V0Qm9keSByZXR1cm5zIHRoZSBib2R5IG9mIGEgZG9jdW1lbnQsIG9yIGFuIGVsZW1lbnQgdGhhdCBjYW4gc3RhbmQgaW4gZm9yCiAgICAgKiB0aGUgYm9keSBpZiBhIHJlYWwgYm9keSBkb2VzIG5vdCBleGlzdAogICAgICoKICAgICAqIEBhY2Nlc3MgcHJpdmF0ZQogICAgICogQGZ1bmN0aW9uIGdldEJvZHkKICAgICAqIEByZXR1cm5zIHtIVE1MRWxlbWVudHxTVkdFbGVtZW50fSBSZXR1cm5zIHRoZSByZWFsIGJvZHkgb2YgYSBkb2N1bWVudCwgb3IgYW4KICAgICAqIGFydGlmaWNpYWxseSBjcmVhdGVkIGVsZW1lbnQgdGhhdCBzdGFuZHMgaW4gZm9yIHRoZSBib2R5CiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldEJvZHkoKSB7CiAgICAgIC8vIEFmdGVyIHBhZ2UgbG9hZCBpbmplY3RpbmcgYSBmYWtlIGJvZHkgZG9lc24ndCB3b3JrIHNvIGNoZWNrIGlmIGJvZHkgZXhpc3RzCiAgICAgIHZhciBib2R5ID0gZG9jdW1lbnQuYm9keTsKICAgICAgaWYgKCFib2R5KSB7CiAgICAgICAgLy8gQ2FuJ3QgdXNlIHRoZSByZWFsIGJvZHkgY3JlYXRlIGEgZmFrZSBvbmUuCiAgICAgICAgYm9keSA9IGNyZWF0ZUVsZW1lbnQoaXNTVkcgPyAnc3ZnJyA6ICdib2R5Jyk7CiAgICAgICAgYm9keS5mYWtlID0gdHJ1ZTsKICAgICAgfQogICAgICByZXR1cm4gYm9keTsKICAgIH0KICAgIDsKCiAgICAvKioKICAgICAqIGluamVjdEVsZW1lbnRXaXRoU3R5bGVzIGluamVjdHMgYW4gZWxlbWVudCB3aXRoIHN0eWxlIGVsZW1lbnQgYW5kIHNvbWUgQ1NTIHJ1bGVzCiAgICAgKgogICAgICogQGFjY2VzcyBwcml2YXRlCiAgICAgKiBAZnVuY3Rpb24gaW5qZWN0RWxlbWVudFdpdGhTdHlsZXMKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBydWxlIC0gU3RyaW5nIHJlcHJlc2VudGluZyBhIGNzcyBydWxlCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayAtIEEgZnVuY3Rpb24gdGhhdCBpcyB1c2VkIHRvIHRlc3QgdGhlIGluamVjdGVkIGVsZW1lbnQKICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbbm9kZXNdIC0gQW4gaW50ZWdlciByZXByZXNlbnRpbmcgdGhlIG51bWJlciBvZiBhZGRpdGlvbmFsIG5vZGVzIHlvdSB3YW50IGluamVjdGVkCiAgICAgKiBAcGFyYW0ge3N0cmluZ1tdfSBbdGVzdG5hbWVzXSAtIEFuIGFycmF5IG9mIHN0cmluZ3MgdGhhdCBhcmUgdXNlZCBhcyBpZHMgZm9yIHRoZSBhZGRpdGlvbmFsIG5vZGVzCiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gdGhlIHJlc3VsdCBvZiB0aGUgc3BlY2lmaWVkIGNhbGxiYWNrIHRlc3QKICAgICAqLwogICAgZnVuY3Rpb24gaW5qZWN0RWxlbWVudFdpdGhTdHlsZXMocnVsZSwgY2FsbGJhY2ssIG5vZGVzLCB0ZXN0bmFtZXMpIHsKICAgICAgdmFyIG1vZCA9ICdtb2Rlcm5penInOwogICAgICB2YXIgc3R5bGU7CiAgICAgIHZhciByZXQ7CiAgICAgIHZhciBub2RlOwogICAgICB2YXIgZG9jT3ZlcmZsb3c7CiAgICAgIHZhciBkaXYgPSBjcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgdmFyIGJvZHkgPSBnZXRCb2R5KCk7CiAgICAgIGlmIChwYXJzZUludChub2RlcywgMTApKSB7CiAgICAgICAgLy8gSW4gb3JkZXIgbm90IHRvIGdpdmUgZmFsc2UgcG9zaXRpdmVzIHdlIGNyZWF0ZSBhIG5vZGUgZm9yIGVhY2ggdGVzdAogICAgICAgIC8vIFRoaXMgYWxzbyBhbGxvd3MgdGhlIG1ldGhvZCB0byBzY2FsZSBmb3IgdW5zcGVjaWZpZWQgdXNlcwogICAgICAgIHdoaWxlIChub2Rlcy0tKSB7CiAgICAgICAgICBub2RlID0gY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICBub2RlLmlkID0gdGVzdG5hbWVzID8gdGVzdG5hbWVzW25vZGVzXSA6IG1vZCArIChub2RlcyArIDEpOwogICAgICAgICAgZGl2LmFwcGVuZENoaWxkKG5vZGUpOwogICAgICAgIH0KICAgICAgfQogICAgICBzdHlsZSA9IGNyZWF0ZUVsZW1lbnQoJ3N0eWxlJyk7CiAgICAgIHN0eWxlLnR5cGUgPSAndGV4dC9jc3MnOwogICAgICBzdHlsZS5pZCA9ICdzJyArIG1vZDsKCiAgICAgIC8vIElFNiB3aWxsIGZhbHNlIHBvc2l0aXZlIG9uIHNvbWUgdGVzdHMgZHVlIHRvIHRoZSBzdHlsZSBlbGVtZW50IGluc2lkZSB0aGUgdGVzdCBkaXYgc29tZWhvdyBpbnRlcmZlcmluZyBvZmZzZXRIZWlnaHQsIHNvIGluc2VydCBpdCBpbnRvIGJvZHkgb3IgZmFrZWJvZHkuCiAgICAgIC8vIE9wZXJhIHdpbGwgYWN0IGFsbCBxdWlya3kgd2hlbiBpbmplY3RpbmcgZWxlbWVudHMgaW4gZG9jdW1lbnRFbGVtZW50IHdoZW4gcGFnZSBpcyBzZXJ2ZWQgYXMgeG1sLCBuZWVkcyBmYWtlYm9keSB0b28uICMyNzAKICAgICAgKCFib2R5LmZha2UgPyBkaXYgOiBib2R5KS5hcHBlbmRDaGlsZChzdHlsZSk7CiAgICAgIGJvZHkuYXBwZW5kQ2hpbGQoZGl2KTsKICAgICAgaWYgKHN0eWxlLnN0eWxlU2hlZXQpIHsKICAgICAgICBzdHlsZS5zdHlsZVNoZWV0LmNzc1RleHQgPSBydWxlOwogICAgICB9IGVsc2UgewogICAgICAgIHN0eWxlLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHJ1bGUpKTsKICAgICAgfQogICAgICBkaXYuaWQgPSBtb2Q7CiAgICAgIGlmIChib2R5LmZha2UpIHsKICAgICAgICAvL2F2b2lkIGNyYXNoaW5nIElFOCwgaWYgYmFja2dyb3VuZCBpbWFnZSBpcyB1c2VkCiAgICAgICAgYm9keS5zdHlsZS5iYWNrZ3JvdW5kID0gJyc7CiAgICAgICAgLy9TYWZhcmkgNS4xMy81LjEuNCBPU1ggc3RvcHMgbG9hZGluZyBpZiA6Oi13ZWJraXQtc2Nyb2xsYmFyIGlzIHVzZWQgYW5kIHNjcm9sbGJhcnMgYXJlIHZpc2libGUKICAgICAgICBib2R5LnN0eWxlLm92ZXJmbG93ID0gJ2hpZGRlbic7CiAgICAgICAgZG9jT3ZlcmZsb3cgPSBkb2NFbGVtZW50LnN0eWxlLm92ZXJmbG93OwogICAgICAgIGRvY0VsZW1lbnQuc3R5bGUub3ZlcmZsb3cgPSAnaGlkZGVuJzsKICAgICAgICBkb2NFbGVtZW50LmFwcGVuZENoaWxkKGJvZHkpOwogICAgICB9CiAgICAgIHJldCA9IGNhbGxiYWNrKGRpdiwgcnVsZSk7CiAgICAgIC8vIElmIHRoaXMgaXMgZG9uZSBhZnRlciBwYWdlIGxvYWQgd2UgZG9uJ3Qgd2FudCB0byByZW1vdmUgdGhlIGJvZHkgc28gY2hlY2sgaWYgYm9keSBleGlzdHMKICAgICAgaWYgKGJvZHkuZmFrZSAmJiBib2R5LnBhcmVudE5vZGUpIHsKICAgICAgICBib2R5LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoYm9keSk7CiAgICAgICAgZG9jRWxlbWVudC5zdHlsZS5vdmVyZmxvdyA9IGRvY092ZXJmbG93OwogICAgICAgIC8vIFRyaWdnZXIgbGF5b3V0IHNvIGtpbmV0aWMgc2Nyb2xsaW5nIGlzbid0IGRpc2FibGVkIGluIGlPUzYrCiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lCiAgICAgICAgZG9jRWxlbWVudC5vZmZzZXRIZWlnaHQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZGl2LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZGl2KTsKICAgICAgfQogICAgICByZXR1cm4gISFyZXQ7CiAgICB9CiAgICA7CgogICAgLyoqCiAgICAgKiBkb21Ub0NTUyB0YWtlcyBhIGNhbWVsQ2FzZSBzdHJpbmcgYW5kIGNvbnZlcnRzIGl0IHRvIGh5cGhlbi1jYXNlCiAgICAgKiBlLmcuIGJveFNpemluZyAtPiBib3gtc2l6aW5nCiAgICAgKgogICAgICogQGFjY2VzcyBwcml2YXRlCiAgICAgKiBAZnVuY3Rpb24gZG9tVG9DU1MKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gU3RyaW5nIG5hbWUgb2YgY2FtZWxDYXNlIHByb3Agd2Ugd2FudCB0byBjb252ZXJ0CiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBUaGUgaHlwaGVuLWNhc2UgdmVyc2lvbiBvZiB0aGUgc3VwcGxpZWQgbmFtZQogICAgICovCiAgICBmdW5jdGlvbiBkb21Ub0NTUyhuYW1lKSB7CiAgICAgIHJldHVybiBuYW1lLnJlcGxhY2UoLyhbQS1aXSkvZywgZnVuY3Rpb24gKHN0ciwgbTEpIHsKICAgICAgICByZXR1cm4gJy0nICsgbTEudG9Mb3dlckNhc2UoKTsKICAgICAgfSkucmVwbGFjZSgvXm1zLS8sICctbXMtJyk7CiAgICB9CiAgICA7CgogICAgLyoqCiAgICAgKiB3cmFwcGVyIGFyb3VuZCBnZXRDb21wdXRlZFN0eWxlLCB0byBmaXggaXNzdWVzIHdpdGggRmlyZWZveCByZXR1cm5pbmcgbnVsbCB3aGVuCiAgICAgKiBjYWxsZWQgaW5zaWRlIG9mIGEgaGlkZGVuIGlmcmFtZQogICAgICoKICAgICAqIEBhY2Nlc3MgcHJpdmF0ZQogICAgICogQGZ1bmN0aW9uIGNvbXB1dGVkU3R5bGUKICAgICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR8U1ZHRWxlbWVudH0gZWxlbSAtIFRoZSBlbGVtZW50IHdlIHdhbnQgdG8gZmluZCB0aGUgY29tcHV0ZWQgc3R5bGVzIG9mCiAgICAgKiBAcGFyYW0ge3N0cmluZ3xudWxsfSBbcHNldWRvXSAtIEFuIG9wdGlvbmFsIHBzZXVkbyBlbGVtZW50IHNlbGVjdG9yIChlLmcuIDpiZWZvcmUpLCBvZiBudWxsIGlmIG5vbmUKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBwcm9wIC0gQSBDU1MgcHJvcGVydHkKICAgICAqIEByZXR1cm5zIHtDU1NTdHlsZURlY2xhcmF0aW9ufSB0aGUgdmFsdWUgb2YgdGhlIHNwZWNpZmllZCBDU1MgcHJvcGVydHkKICAgICAqLwogICAgZnVuY3Rpb24gY29tcHV0ZWRTdHlsZShlbGVtLCBwc2V1ZG8sIHByb3ApIHsKICAgICAgdmFyIHJlc3VsdDsKICAgICAgaWYgKCdnZXRDb21wdXRlZFN0eWxlJyBpbiB3aW5kb3cpIHsKICAgICAgICByZXN1bHQgPSBnZXRDb21wdXRlZFN0eWxlLmNhbGwod2luZG93LCBlbGVtLCBwc2V1ZG8pOwogICAgICAgIHZhciBjb25zb2xlID0gd2luZG93LmNvbnNvbGU7CiAgICAgICAgaWYgKHJlc3VsdCAhPT0gbnVsbCkgewogICAgICAgICAgaWYgKHByb3ApIHsKICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmdldFByb3BlcnR5VmFsdWUocHJvcCk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChjb25zb2xlKSB7CiAgICAgICAgICAgIHZhciBtZXRob2QgPSBjb25zb2xlLmVycm9yID8gJ2Vycm9yJyA6ICdsb2cnOwogICAgICAgICAgICBjb25zb2xlW21ldGhvZF0uY2FsbChjb25zb2xlLCAnZ2V0Q29tcHV0ZWRTdHlsZSByZXR1cm5pbmcgbnVsbCwgaXRzIHBvc3NpYmxlIG1vZGVybml6ciB0ZXN0IHJlc3VsdHMgYXJlIGluYWNjdXJhdGUnKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVzdWx0ID0gIXBzZXVkbyAmJiBlbGVtLmN1cnJlbnRTdHlsZSAmJiBlbGVtLmN1cnJlbnRTdHlsZVtwcm9wXTsKICAgICAgfQogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgOwoKICAgIC8qKgogICAgICogbmF0aXZlVGVzdFByb3BzIGFsbG93cyBmb3IgdXMgdG8gdXNlIG5hdGl2ZSBmZWF0dXJlIGRldGVjdGlvbiBmdW5jdGlvbmFsaXR5IGlmIGF2YWlsYWJsZS4KICAgICAqIHNvbWUgcHJlZml4ZWQgZm9ybSwgb3IgZmFsc2UsIGluIHRoZSBjYXNlIG9mIGFuIHVuc3VwcG9ydGVkIHJ1bGUKICAgICAqCiAgICAgKiBAYWNjZXNzIHByaXZhdGUKICAgICAqIEBmdW5jdGlvbiBuYXRpdmVUZXN0UHJvcHMKICAgICAqIEBwYXJhbSB7QXJyYXl9IHByb3BzIC0gQW4gYXJyYXkgb2YgcHJvcGVydHkgbmFtZXMKICAgICAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZSAtIEEgc3RyaW5nIHJlcHJlc2VudGluZyB0aGUgdmFsdWUgd2Ugd2FudCB0byBjaGVjayB2aWEgQHN1cHBvcnRzCiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbnx1bmRlZmluZWR9IEEgYm9vbGVhbiB3aGVuIEBzdXBwb3J0cyBleGlzdHMsIHVuZGVmaW5lZCBvdGhlcndpc2UKICAgICAqLwogICAgLy8gQWNjZXB0cyBhIGxpc3Qgb2YgcHJvcGVydHkgbmFtZXMgYW5kIGEgc2luZ2xlIHZhbHVlCiAgICAvLyBSZXR1cm5zIGB1bmRlZmluZWRgIGlmIG5hdGl2ZSBkZXRlY3Rpb24gbm90IGF2YWlsYWJsZQogICAgZnVuY3Rpb24gbmF0aXZlVGVzdFByb3BzKHByb3BzLCB2YWx1ZSkgewogICAgICB2YXIgaSA9IHByb3BzLmxlbmd0aDsKICAgICAgLy8gU3RhcnQgd2l0aCB0aGUgSlMgQVBJOiBodHRwczovL3d3dy53My5vcmcvVFIvY3NzMy1jb25kaXRpb25hbC8jdGhlLWNzcy1pbnRlcmZhY2UKICAgICAgaWYgKCdDU1MnIGluIHdpbmRvdyAmJiAnc3VwcG9ydHMnIGluIHdpbmRvdy5DU1MpIHsKICAgICAgICAvLyBUcnkgZXZlcnkgcHJlZml4ZWQgdmFyaWFudCBvZiB0aGUgcHJvcGVydHkKICAgICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgICBpZiAod2luZG93LkNTUy5zdXBwb3J0cyhkb21Ub0NTUyhwcm9wc1tpXSksIHZhbHVlKSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIC8vIE90aGVyd2lzZSBmYWxsIGJhY2sgdG8gYXQtcnVsZSAoZm9yIE9wZXJhIDEyLngpCiAgICAgIGVsc2UgaWYgKCdDU1NTdXBwb3J0c1J1bGUnIGluIHdpbmRvdykgewogICAgICAgIC8vIEJ1aWxkIGEgY29uZGl0aW9uIHN0cmluZyBmb3IgZXZlcnkgcHJlZml4ZWQgdmFyaWFudAogICAgICAgIHZhciBjb25kaXRpb25UZXh0ID0gW107CiAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgY29uZGl0aW9uVGV4dC5wdXNoKCcoJyArIGRvbVRvQ1NTKHByb3BzW2ldKSArICc6JyArIHZhbHVlICsgJyknKTsKICAgICAgICB9CiAgICAgICAgY29uZGl0aW9uVGV4dCA9IGNvbmRpdGlvblRleHQuam9pbignIG9yICcpOwogICAgICAgIHJldHVybiBpbmplY3RFbGVtZW50V2l0aFN0eWxlcygnQHN1cHBvcnRzICgnICsgY29uZGl0aW9uVGV4dCArICcpIHsgI21vZGVybml6ciB7IHBvc2l0aW9uOiBhYnNvbHV0ZTsgfSB9JywgZnVuY3Rpb24gKG5vZGUpIHsKICAgICAgICAgIHJldHVybiBjb21wdXRlZFN0eWxlKG5vZGUsIG51bGwsICdwb3NpdGlvbicpID09PSAnYWJzb2x1dGUnOwogICAgICAgIH0pOwogICAgICB9CiAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICB9CiAgICA7CgogICAgLyoqCiAgICAgKiBjc3NUb0RPTSB0YWtlcyBhIGh5cGhlbi1jYXNlIHN0cmluZyBhbmQgY29udmVydHMgaXQgdG8gY2FtZWxDYXNlCiAgICAgKiBlLmcuIGJveC1zaXppbmcgLT4gYm94U2l6aW5nCiAgICAgKgogICAgICogQGFjY2VzcyBwcml2YXRlCiAgICAgKiBAZnVuY3Rpb24gY3NzVG9ET00KICAgICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gU3RyaW5nIG5hbWUgb2YgaHlwaGVuLWNhc2UgcHJvcCB3ZSB3YW50IHRvIGNvbnZlcnQKICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IFRoZSBjYW1lbENhc2UgdmVyc2lvbiBvZiB0aGUgc3VwcGxpZWQgbmFtZQogICAgICovCiAgICBmdW5jdGlvbiBjc3NUb0RPTShuYW1lKSB7CiAgICAgIHJldHVybiBuYW1lLnJlcGxhY2UoLyhbYS16XSktKFthLXpdKS9nLCBmdW5jdGlvbiAoc3RyLCBtMSwgbTIpIHsKICAgICAgICByZXR1cm4gbTEgKyBtMi50b1VwcGVyQ2FzZSgpOwogICAgICB9KS5yZXBsYWNlKC9eLS8sICcnKTsKICAgIH0KICAgIDsKCiAgICAvLyB0ZXN0UHJvcHMgaXMgYSBnZW5lcmljIENTUyAvIERPTSBwcm9wZXJ0eSB0ZXN0LgoKICAgIC8vIEluIHRlc3Rpbmcgc3VwcG9ydCBmb3IgYSBnaXZlbiBDU1MgcHJvcGVydHksIGl0J3MgbGVnaXQgdG8gdGVzdDoKICAgIC8vICAgIGBlbGVtLnN0eWxlW3N0eWxlTmFtZV0gIT09IHVuZGVmaW5lZGAKICAgIC8vIElmIHRoZSBwcm9wZXJ0eSBpcyBzdXBwb3J0ZWQgaXQgd2lsbCByZXR1cm4gYW4gZW1wdHkgc3RyaW5nLAogICAgLy8gaWYgdW5zdXBwb3J0ZWQgaXQgd2lsbCByZXR1cm4gdW5kZWZpbmVkLgoKICAgIC8vIFdlJ2xsIHRha2UgYWR2YW50YWdlIG9mIHRoaXMgcXVpY2sgdGVzdCBhbmQgc2tpcCBzZXR0aW5nIGEgc3R5bGUKICAgIC8vIG9uIG91ciBtb2Rlcm5penIgZWxlbWVudCwgYnV0IGluc3RlYWQganVzdCB0ZXN0aW5nIHVuZGVmaW5lZCB2cwogICAgLy8gZW1wdHkgc3RyaW5nLgoKICAgIC8vIFByb3BlcnR5IG5hbWVzIGNhbiBiZSBwcm92aWRlZCBpbiBlaXRoZXIgY2FtZWxDYXNlIG9yIGh5cGhlbi1jYXNlLgoKICAgIGZ1bmN0aW9uIHRlc3RQcm9wcyhwcm9wcywgcHJlZml4ZWQsIHZhbHVlLCBza2lwVmFsdWVUZXN0KSB7CiAgICAgIHNraXBWYWx1ZVRlc3QgPSBpcyhza2lwVmFsdWVUZXN0LCAndW5kZWZpbmVkJykgPyBmYWxzZSA6IHNraXBWYWx1ZVRlc3Q7CgogICAgICAvLyBUcnkgbmF0aXZlIGRldGVjdCBmaXJzdAogICAgICBpZiAoIWlzKHZhbHVlLCAndW5kZWZpbmVkJykpIHsKICAgICAgICB2YXIgcmVzdWx0ID0gbmF0aXZlVGVzdFByb3BzKHByb3BzLCB2YWx1ZSk7CiAgICAgICAgaWYgKCFpcyhyZXN1bHQsICd1bmRlZmluZWQnKSkgewogICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vIE90aGVyd2lzZSBkbyBpdCBwcm9wZXJseQogICAgICB2YXIgYWZ0ZXJJbml0LCBpLCBwcm9wc0xlbmd0aCwgcHJvcCwgYmVmb3JlOwoKICAgICAgLy8gSWYgd2UgZG9uJ3QgaGF2ZSBhIHN0eWxlIGVsZW1lbnQsIHRoYXQgbWVhbnMgd2UncmUgcnVubmluZyBhc3luYyBvciBhZnRlcgogICAgICAvLyB0aGUgY29yZSB0ZXN0cywgc28gd2UnbGwgbmVlZCB0byBjcmVhdGUgb3VyIG93biBlbGVtZW50cyB0byB1c2UuCgogICAgICAvLyBJbnNpZGUgb2YgYW4gU1ZHIGVsZW1lbnQsIGluIGNlcnRhaW4gYnJvd3NlcnMsIHRoZSBgc3R5bGVgIGVsZW1lbnQgaXMgb25seQogICAgICAvLyBkZWZpbmVkIGZvciB2YWxpZCB0YWdzLiBUaGVyZWZvcmUsIGlmIGBtb2Rlcm5penJgIGRvZXMgbm90IGhhdmUgb25lLCB3ZQogICAgICAvLyBmYWxsIGJhY2sgdG8gYSBsZXNzIHVzZWQgZWxlbWVudCBhbmQgaG9wZSBmb3IgdGhlIGJlc3QuCiAgICAgIC8vIEZvciBzdHJpY3QgWEhUTUwgYnJvd3NlcnMgdGhlIGhhcmRseSB1c2VkIHNhbXAgZWxlbWVudCBpcyB1c2VkLgogICAgICB2YXIgZWxlbXMgPSBbJ21vZGVybml6cicsICd0c3BhbicsICdzYW1wJ107CiAgICAgIHdoaWxlICghbVN0eWxlLnN0eWxlICYmIGVsZW1zLmxlbmd0aCkgewogICAgICAgIGFmdGVySW5pdCA9IHRydWU7CiAgICAgICAgbVN0eWxlLm1vZEVsZW0gPSBjcmVhdGVFbGVtZW50KGVsZW1zLnNoaWZ0KCkpOwogICAgICAgIG1TdHlsZS5zdHlsZSA9IG1TdHlsZS5tb2RFbGVtLnN0eWxlOwogICAgICB9CgogICAgICAvLyBEZWxldGUgdGhlIG9iamVjdHMgaWYgd2UgY3JlYXRlZCB0aGVtLgogICAgICBmdW5jdGlvbiBjbGVhbkVsZW1zKCkgewogICAgICAgIGlmIChhZnRlckluaXQpIHsKICAgICAgICAgIGRlbGV0ZSBtU3R5bGUuc3R5bGU7CiAgICAgICAgICBkZWxldGUgbVN0eWxlLm1vZEVsZW07CiAgICAgICAgfQogICAgICB9CiAgICAgIHByb3BzTGVuZ3RoID0gcHJvcHMubGVuZ3RoOwogICAgICBmb3IgKGkgPSAwOyBpIDwgcHJvcHNMZW5ndGg7IGkrKykgewogICAgICAgIHByb3AgPSBwcm9wc1tpXTsKICAgICAgICBiZWZvcmUgPSBtU3R5bGUuc3R5bGVbcHJvcF07CiAgICAgICAgaWYgKGNvbnRhaW5zKHByb3AsICctJykpIHsKICAgICAgICAgIHByb3AgPSBjc3NUb0RPTShwcm9wKTsKICAgICAgICB9CiAgICAgICAgaWYgKG1TdHlsZS5zdHlsZVtwcm9wXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAvLyBJZiB2YWx1ZSB0byB0ZXN0IGhhcyBiZWVuIHBhc3NlZCBpbiwgZG8gYSBzZXQtYW5kLWNoZWNrIHRlc3QuCiAgICAgICAgICAvLyAwIChpbnRlZ2VyKSBpcyBhIHZhbGlkIHByb3BlcnR5IHZhbHVlLCBzbyBjaGVjayB0aGF0IGB2YWx1ZWAgaXNuJ3QKICAgICAgICAgIC8vIHVuZGVmaW5lZCwgcmF0aGVyIHRoYW4ganVzdCBjaGVja2luZyBpdCdzIHRydXRoeS4KICAgICAgICAgIGlmICghc2tpcFZhbHVlVGVzdCAmJiAhaXModmFsdWUsICd1bmRlZmluZWQnKSkgewogICAgICAgICAgICAvLyBOZWVkcyBhIHRyeSBjYXRjaCBibG9jayBiZWNhdXNlIG9mIG9sZCBJRS4gVGhpcyBpcyBzbG93LCBidXQgd2lsbAogICAgICAgICAgICAvLyBiZSBhdm9pZGVkIGluIG1vc3QgY2FzZXMgYmVjYXVzZSBgc2tpcFZhbHVlVGVzdGAgd2lsbCBiZSB1c2VkLgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIG1TdHlsZS5zdHlsZVtwcm9wXSA9IHZhbHVlOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7fQoKICAgICAgICAgICAgLy8gSWYgdGhlIHByb3BlcnR5IHZhbHVlIGhhcyBjaGFuZ2VkLCB3ZSBhc3N1bWUgdGhlIHZhbHVlIHVzZWQgaXMKICAgICAgICAgICAgLy8gc3VwcG9ydGVkLiBJZiBgdmFsdWVgIGlzIGVtcHR5IHN0cmluZywgaXQnbGwgZmFpbCBoZXJlIChiZWNhdXNlCiAgICAgICAgICAgIC8vIGl0IGhhc24ndCBjaGFuZ2VkKSwgd2hpY2ggbWF0Y2hlcyBob3cgYnJvd3NlcnMgaGF2ZSBpbXBsZW1lbnRlZAogICAgICAgICAgICAvLyBDU1Muc3VwcG9ydHMoKQogICAgICAgICAgICBpZiAobVN0eWxlLnN0eWxlW3Byb3BdICE9PSBiZWZvcmUpIHsKICAgICAgICAgICAgICBjbGVhbkVsZW1zKCk7CiAgICAgICAgICAgICAgcmV0dXJuIHByZWZpeGVkID09PSAncGZ4JyA/IHByb3AgOiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAvLyBPdGhlcndpc2UganVzdCByZXR1cm4gdHJ1ZSwgb3IgdGhlIHByb3BlcnR5IG5hbWUgaWYgdGhpcyBpcyBhCiAgICAgICAgICAvLyBgcHJlZml4ZWQoKWAgY2FsbAogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGNsZWFuRWxlbXMoKTsKICAgICAgICAgICAgcmV0dXJuIHByZWZpeGVkID09PSAncGZ4JyA/IHByb3AgOiB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBjbGVhbkVsZW1zKCk7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIDsKCiAgICAvKioKICAgICAqIExpc3Qgb2YgSmF2YVNjcmlwdCBET00gdmFsdWVzIHVzZWQgZm9yIHRlc3RzCiAgICAgKgogICAgICogQG1lbWJlck9mIE1vZGVybml6cgogICAgICogQG5hbWUgTW9kZXJuaXpyLl9kb21QcmVmaXhlcwogICAgICogQG9wdGlvbk5hbWUgTW9kZXJuaXpyLl9kb21QcmVmaXhlcwogICAgICogQG9wdGlvblByb3AgZG9tUHJlZml4ZXMKICAgICAqIEBhY2Nlc3MgcHVibGljCiAgICAgKiBAZXhhbXBsZQogICAgICoKICAgICAqIE1vZGVybml6ci5fZG9tUHJlZml4ZXMgaXMgZXhhY3RseSB0aGUgc2FtZSBhcyBbX3ByZWZpeGVzXSgjbW9kZXJuaXpyLV9wcmVmaXhlcyksIGJ1dCByYXRoZXIKICAgICAqIHRoYW4gaHlwaGVuLWNhc2UgcHJvcGVydGllcywgYWxsIHByb3BlcnRpZXMgYXJlIHRoZWlyIENhcGl0YWxpemVkIHZhcmlhbnQKICAgICAqCiAgICAgKiBgYGBqcwogICAgICogTW9kZXJuaXpyLl9kb21QcmVmaXhlcyA9PT0gWyAiTW96IiwgIk8iLCAibXMiLCAiV2Via2l0IiBdOwogICAgICogYGBgCiAgICAgKi8KICAgIHZhciBkb21QcmVmaXhlcyA9IE1vZGVybml6clByb3RvLl9jb25maWcudXNlUHJlZml4ZXMgPyBvbVByZWZpeGVzLnRvTG93ZXJDYXNlKCkuc3BsaXQoJyAnKSA6IFtdOwogICAgTW9kZXJuaXpyUHJvdG8uX2RvbVByZWZpeGVzID0gZG9tUHJlZml4ZXM7CgogICAgLyoqCiAgICAgKiBmbkJpbmQgaXMgYSBzdXBlciBzbWFsbCBbYmluZF0oaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvRnVuY3Rpb24vYmluZCkgcG9seWZpbGwuCiAgICAgKgogICAgICogQGFjY2VzcyBwcml2YXRlCiAgICAgKiBAZnVuY3Rpb24gZm5CaW5kCiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbiAtIGEgZnVuY3Rpb24geW91IHdhbnQgdG8gY2hhbmdlIGB0aGlzYCByZWZlcmVuY2UgdG8KICAgICAqIEBwYXJhbSB7b2JqZWN0fSB0aGF0IC0gdGhlIGB0aGlzYCB5b3Ugd2FudCB0byBjYWxsIHRoZSBmdW5jdGlvbiB3aXRoCiAgICAgKiBAcmV0dXJucyB7RnVuY3Rpb259IFRoZSB3cmFwcGVkIHZlcnNpb24gb2YgdGhlIHN1cHBsaWVkIGZ1bmN0aW9uCiAgICAgKi8KICAgIGZ1bmN0aW9uIGZuQmluZChmbiwgdGhhdCkgewogICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBmbi5hcHBseSh0aGF0LCBhcmd1bWVudHMpOwogICAgICB9OwogICAgfQogICAgOwoKICAgIC8qKgogICAgICogdGVzdERPTVByb3BzIGlzIGEgZ2VuZXJpYyBET00gcHJvcGVydHkgdGVzdDsgaWYgYSBicm93c2VyIHN1cHBvcnRzCiAgICAgKiAgIGEgY2VydGFpbiBwcm9wZXJ0eSwgaXQgd29uJ3QgcmV0dXJuIHVuZGVmaW5lZCBmb3IgaXQuCiAgICAgKgogICAgICogQGFjY2VzcyBwcml2YXRlCiAgICAgKiBAZnVuY3Rpb24gdGVzdERPTVByb3BzCiAgICAgKiBAcGFyYW0ge0FycmF5PHN0cmluZz59IHByb3BzIC0gQW4gYXJyYXkgb2YgcHJvcGVydGllcyB0byB0ZXN0IGZvcgogICAgICogQHBhcmFtIHtvYmplY3R9IG9iaiAtIEFuIG9iamVjdCBvciBFbGVtZW50IHlvdSB3YW50IHRvIHVzZSB0byB0ZXN0IHRoZSBwYXJhbWV0ZXJzIGFnYWluCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW58b2JqZWN0fSBlbGVtIC0gQW4gRWxlbWVudCB0byBiaW5kIHRoZSBwcm9wZXJ0eSBsb29rdXAgYWdhaW4uIFVzZSBgZmFsc2VgIHRvIHByZXZlbnQgdGhlIGNoZWNrCiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbnwqfSByZXR1cm5zIGBmYWxzZWAgaWYgdGhlIHByb3AgaXMgdW5zdXBwb3J0ZWQsIG90aGVyd2lzZSB0aGUgdmFsdWUgdGhhdCBpcyBzdXBwb3J0ZWQKICAgICAqLwogICAgZnVuY3Rpb24gdGVzdERPTVByb3BzKHByb3BzLCBvYmosIGVsZW0pIHsKICAgICAgdmFyIGl0ZW07CiAgICAgIGZvciAodmFyIGkgaW4gcHJvcHMpIHsKICAgICAgICBpZiAocHJvcHNbaV0gaW4gb2JqKSB7CiAgICAgICAgICAvLyByZXR1cm4gdGhlIHByb3BlcnR5IG5hbWUgYXMgYSBzdHJpbmcKICAgICAgICAgIGlmIChlbGVtID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gcHJvcHNbaV07CiAgICAgICAgICB9CiAgICAgICAgICBpdGVtID0gb2JqW3Byb3BzW2ldXTsKCiAgICAgICAgICAvLyBsZXQncyBiaW5kIGEgZnVuY3Rpb24KICAgICAgICAgIGlmIChpcyhpdGVtLCAnZnVuY3Rpb24nKSkgewogICAgICAgICAgICAvLyBiaW5kIHRvIG9iaiB1bmxlc3Mgb3ZlcnJpZGRlbgogICAgICAgICAgICByZXR1cm4gZm5CaW5kKGl0ZW0sIGVsZW0gfHwgb2JqKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyByZXR1cm4gdGhlIHVuYm91bmQgZnVuY3Rpb24gb3Igb2JqIG9yIHZhbHVlCiAgICAgICAgICByZXR1cm4gaXRlbTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgOwoKICAgIC8qKgogICAgICogdGVzdFByb3BzQWxsIHRlc3RzIGEgbGlzdCBvZiBET00gcHJvcGVydGllcyB3ZSB3YW50IHRvIGNoZWNrIGFnYWluc3QuCiAgICAgKiBXZSBzcGVjaWZ5IGxpdGVyYWxseSBBTEwgcG9zc2libGUgKGtub3duIGFuZC9vciBsaWtlbHkpIHByb3BlcnRpZXMgb24KICAgICAqIHRoZSBlbGVtZW50IGluY2x1ZGluZyB0aGUgbm9uLXZlbmRvciBwcmVmaXhlZCBvbmUsIGZvciBmb3J3YXJkLQogICAgICogY29tcGF0aWJpbGl0eS4KICAgICAqCiAgICAgKiBAYWNjZXNzIHByaXZhdGUKICAgICAqIEBmdW5jdGlvbiB0ZXN0UHJvcHNBbGwKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBwcm9wIC0gQSBzdHJpbmcgb2YgdGhlIHByb3BlcnR5IHRvIHRlc3QgZm9yCiAgICAgKiBAcGFyYW0ge3N0cmluZ3xvYmplY3R9IFtwcmVmaXhlZF0gLSBBbiBvYmplY3QgdG8gY2hlY2sgdGhlIHByZWZpeGVkIHByb3BlcnRpZXMgb24uIFVzZSBhIHN0cmluZyB0byBza2lwCiAgICAgKiBAcGFyYW0ge0hUTUxFbGVtZW50fFNWR0VsZW1lbnR9IFtlbGVtXSAtIEFuIGVsZW1lbnQgdXNlZCB0byB0ZXN0IHRoZSBwcm9wZXJ0eSBhbmQgdmFsdWUgYWdhaW5zdAogICAgICogQHBhcmFtIHtzdHJpbmd9IFt2YWx1ZV0gLSBBIHN0cmluZyBvZiBhIGNzcyB2YWx1ZQogICAgICogQHBhcmFtIHtib29sZWFufSBbc2tpcFZhbHVlVGVzdF0gLSBBbiBib29sZWFuIHJlcHJlc2VudGluZyBpZiB5b3Ugd2FudCB0byB0ZXN0IGlmIHZhbHVlIHN0aWNrcyB3aGVuIHNldAogICAgICogQHJldHVybnMge3N0cmluZ3xib29sZWFufSByZXR1cm5zIHRoZSBzdHJpbmcgdmVyc2lvbiBvZiB0aGUgcHJvcGVydHksIG9yIGBmYWxzZWAgaWYgaXQgaXMgdW5zdXBwb3J0ZWQKICAgICAqLwogICAgZnVuY3Rpb24gdGVzdFByb3BzQWxsKHByb3AsIHByZWZpeGVkLCBlbGVtLCB2YWx1ZSwgc2tpcFZhbHVlVGVzdCkgewogICAgICB2YXIgdWNQcm9wID0gcHJvcC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHByb3Auc2xpY2UoMSksCiAgICAgICAgcHJvcHMgPSAocHJvcCArICcgJyArIGNzc29tUHJlZml4ZXMuam9pbih1Y1Byb3AgKyAnICcpICsgdWNQcm9wKS5zcGxpdCgnICcpOwoKICAgICAgLy8gZGlkIHRoZXkgY2FsbCAucHJlZml4ZWQoJ2JveFNpemluZycpIG9yIGFyZSB3ZSBqdXN0IHRlc3RpbmcgYSBwcm9wPwogICAgICBpZiAoaXMocHJlZml4ZWQsICdzdHJpbmcnKSB8fCBpcyhwcmVmaXhlZCwgJ3VuZGVmaW5lZCcpKSB7CiAgICAgICAgcmV0dXJuIHRlc3RQcm9wcyhwcm9wcywgcHJlZml4ZWQsIHZhbHVlLCBza2lwVmFsdWVUZXN0KTsKCiAgICAgICAgLy8gb3RoZXJ3aXNlLCB0aGV5IGNhbGxlZCAucHJlZml4ZWQoJ3JlcXVlc3RBbmltYXRpb25GcmFtZScsIHdpbmRvd1ssIGVsZW1dKQogICAgICB9IGVsc2UgewogICAgICAgIHByb3BzID0gKHByb3AgKyAnICcgKyBkb21QcmVmaXhlcy5qb2luKHVjUHJvcCArICcgJykgKyB1Y1Byb3ApLnNwbGl0KCcgJyk7CiAgICAgICAgcmV0dXJuIHRlc3RET01Qcm9wcyhwcm9wcywgcHJlZml4ZWQsIGVsZW0pOwogICAgICB9CiAgICB9CgogICAgLy8gTW9kZXJuaXpyLnRlc3RBbGxQcm9wcygpIGludmVzdGlnYXRlcyB3aGV0aGVyIGEgZ2l2ZW4gc3R5bGUgcHJvcGVydHksCiAgICAvLyBvciBhbnkgb2YgaXRzIHZlbmRvci1wcmVmaXhlZCB2YXJpYW50cywgaXMgcmVjb2duaXplZAogICAgLy8KICAgIC8vIE5vdGUgdGhhdCB0aGUgcHJvcGVydHkgbmFtZXMgbXVzdCBiZSBwcm92aWRlZCBpbiB0aGUgY2FtZWxDYXNlIHZhcmlhbnQuCiAgICAvLyBNb2Rlcm5penIudGVzdEFsbFByb3BzKCdib3hTaXppbmcnKQogICAgTW9kZXJuaXpyUHJvdG8udGVzdEFsbFByb3BzID0gdGVzdFByb3BzQWxsOwoKICAgIC8qKgogICAgICogdGVzdEFsbFByb3BzIGRldGVybWluZXMgd2hldGhlciBhIGdpdmVuIENTUyBwcm9wZXJ0eSBpcyBzdXBwb3J0ZWQgaW4gdGhlIGJyb3dzZXIKICAgICAqCiAgICAgKiBAbWVtYmVyT2YgTW9kZXJuaXpyCiAgICAgKiBAbmFtZSBNb2Rlcm5penIudGVzdEFsbFByb3BzCiAgICAgKiBAb3B0aW9uTmFtZSBNb2Rlcm5penIudGVzdEFsbFByb3BzKCkKICAgICAqIEBvcHRpb25Qcm9wIHRlc3RBbGxQcm9wcwogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEBmdW5jdGlvbiB0ZXN0QWxsUHJvcHMKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBwcm9wIC0gU3RyaW5nIG5hbWluZyB0aGUgcHJvcGVydHkgdG8gdGVzdCAoZWl0aGVyIGNhbWVsQ2FzZSBvciBoeXBoZW4tY2FzZSkKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbdmFsdWVdIC0gU3RyaW5nIG9mIHRoZSB2YWx1ZSB0byB0ZXN0CiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtza2lwVmFsdWVUZXN0PWZhbHNlXSAtIFdoZXRoZXIgdG8gc2tpcCB0ZXN0aW5nIHRoYXQgdGhlIHZhbHVlIGlzIHN1cHBvcnRlZCB3aGVuIHVzaW5nIG5vbi1uYXRpdmUgZGV0ZWN0aW9uCiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfGJvb2xlYW59IHJldHVybnMgdGhlIHN0cmluZyB2ZXJzaW9uIG9mIHRoZSBwcm9wZXJ0eSwgb3IgYGZhbHNlYCBpZiBpdCBpcyB1bnN1cHBvcnRlZAogICAgICogQGV4YW1wbGUKICAgICAqCiAgICAgKiB0ZXN0QWxsUHJvcHMgZGV0ZXJtaW5lcyB3aGV0aGVyIGEgZ2l2ZW4gQ1NTIHByb3BlcnR5LCBpbiBzb21lIHByZWZpeGVkIGZvcm0sCiAgICAgKiBpcyBzdXBwb3J0ZWQgYnkgdGhlIGJyb3dzZXIuCiAgICAgKgogICAgICogYGBganMKICAgICAqIHRlc3RBbGxQcm9wcygnYm94U2l6aW5nJykgIC8vIHRydWUKICAgICAqIGBgYAogICAgICoKICAgICAqIEl0IGNhbiBvcHRpb25hbGx5IGJlIGdpdmVuIGEgQ1NTIHZhbHVlIGluIHN0cmluZyBmb3JtIHRvIHRlc3QgaWYgYSBwcm9wZXJ0eQogICAgICogdmFsdWUgaXMgdmFsaWQKICAgICAqCiAgICAgKiBgYGBqcwogICAgICogdGVzdEFsbFByb3BzKCdkaXNwbGF5JywgJ2Jsb2NrJykgLy8gdHJ1ZQogICAgICogdGVzdEFsbFByb3BzKCdkaXNwbGF5JywgJ3Blbmd1aW4nKSAvLyBmYWxzZQogICAgICogYGBgCiAgICAgKgogICAgICogQSBib29sZWFuIGNhbiBiZSBwYXNzZWQgYXMgYSB0aGlyZCBwYXJhbWV0ZXIgdG8gc2tpcCB0aGUgdmFsdWUgY2hlY2sgd2hlbgogICAgICogbmF0aXZlIGRldGVjdGlvbiAoQHN1cHBvcnRzKSBpc24ndCBhdmFpbGFibGUuCiAgICAgKgogICAgICogYGBganMKICAgICAqIHRlc3RBbGxQcm9wcygnc2hhcGVPdXRzaWRlJywgJ2NvbnRlbnQtYm94JywgdHJ1ZSk7CiAgICAgKiBgYGAKICAgICAqLwogICAgZnVuY3Rpb24gdGVzdEFsbFByb3BzKHByb3AsIHZhbHVlLCBza2lwVmFsdWVUZXN0KSB7CiAgICAgIHJldHVybiB0ZXN0UHJvcHNBbGwocHJvcCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHZhbHVlLCBza2lwVmFsdWVUZXN0KTsKICAgIH0KICAgIE1vZGVybml6clByb3RvLnRlc3RBbGxQcm9wcyA9IHRlc3RBbGxQcm9wczsKCiAgICAvKiEKICAgIHsKICAgICAgIm5hbWUiOiAiQmFja2Ryb3AgRmlsdGVyIiwKICAgICAgInByb3BlcnR5IjogImJhY2tkcm9wZmlsdGVyIiwKICAgICAgImF1dGhvcnMiOiBbIkJyaWFuIFNld2FyZCJdLAogICAgICAidGFncyI6IFsiY3NzIl0sCiAgICAgICJjYW5pdXNlIjogImNzcy1iYWNrZHJvcC1maWx0ZXIiLAogICAgICAibm90ZXMiOiBbewogICAgICAgICJuYW1lIjogIlczQyBFZGl0b3LigJlzIERyYWZ0IFNwZWMiLAogICAgICAgICJocmVmIjogImh0dHBzOi8vZHJhZnRzLmZ4dGYub3JnL2ZpbHRlcnMtMi8jQmFja2Ryb3BGaWx0ZXJQcm9wZXJ0eSIKICAgICAgfSwgewogICAgICAgICJuYW1lIjogIldlYktpdCBCbG9nIGludHJvZHVjdGlvbiArIERlbW8iLAogICAgICAgICJocmVmIjogImh0dHBzOi8vd3d3LndlYmtpdC5vcmcvYmxvZy8zNjMyL2ludHJvZHVjaW5nLWJhY2tkcm9wLWZpbHRlcnMvIgogICAgICB9XQogICAgfQogICAgISovCiAgICAvKiBET0MKICAgIERldGVjdHMgc3VwcG9ydCBmb3IgQ1NTIEJhY2tkcm9wIEZpbHRlcnMsIGFsbG93aW5nIGZvciBiYWNrZ3JvdW5kIGJsdXIgZWZmZWN0cyBsaWtlIHRob3NlIGludHJvZHVjZWQgaW4gaU9TIDcuIFN1cHBvcnQgZm9yIHRoaXMgd2FzIGFkZGVkIHRvIGlPUyBTYWZhcmkvV2ViS2l0IGluIGlPUyA5LgogICAgKi8KCiAgICBNb2Rlcm5penIuYWRkVGVzdCgnYmFja2Ryb3BmaWx0ZXInLCB0ZXN0QWxsUHJvcHMoJ2JhY2tkcm9wRmlsdGVyJykpOwoKICAgIC8vIFJ1biBlYWNoIHRlc3QKICAgIHRlc3RSdW5uZXIoKTsKCiAgICAvLyBSZW1vdmUgdGhlICJuby1qcyIgY2xhc3MgaWYgaXQgZXhpc3RzCiAgICBzZXRDbGFzc2VzKGNsYXNzZXMpOwogICAgZGVsZXRlIE1vZGVybml6clByb3RvLmFkZFRlc3Q7CiAgICBkZWxldGUgTW9kZXJuaXpyUHJvdG8uYWRkQXN5bmNUZXN0OwoKICAgIC8vIFJ1biB0aGUgdGhpbmdzIHRoYXQgYXJlIHN1cHBvc2VkIHRvIHJ1biBhZnRlciB0aGUgdGVzdHMKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgTW9kZXJuaXpyLl9xLmxlbmd0aDsgaSsrKSB7CiAgICAgIE1vZGVybml6ci5fcVtpXSgpOwogICAgfQoKICAgIC8vIExlYWsgTW9kZXJuaXpyIG5hbWVzcGFjZQogICAgc2NyaXB0R2xvYmFsT2JqZWN0Lk1vZGVybml6ciA9IE1vZGVybml6cjsKICAgIDsKICB9KSh3aW5kb3csIHdpbmRvdywgZG9jdW1lbnQpOwogIG1vZHVsZS5leHBvcnRzID0gd2luZG93Lk1vZGVybml6cjsKICBpZiAoaGFkR2xvYmFsKSB7CiAgICB3aW5kb3cuTW9kZXJuaXpyID0gb2xkR2xvYmFsOwogIH0gZWxzZSB7CiAgICBkZWxldGUgd2luZG93Lk1vZGVybml6cjsKICB9Cn0pKHdpbmRvdyk7"},null]}